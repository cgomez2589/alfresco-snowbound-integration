function vvDocViewState(E,F,C,B,A,D){this.documentId=E;this.documentModel=F;this.pageCount=C;this.pageNumber=B;this.tabNumber=A;this.closedTab=false;this.currentLayer=null;this.layerNames=[];this.imageObject=null;this.displayName=null;this.isSearchable=false;this.firstSearchPage=null;this.lastSearchPage=null;if(C){initPageStatesArray(C,D)}}var vvDocViewStateElement=function(A){this.flipHorizontal=false;this.flipVertical=false;this.zoom=100;this.zoomMode=A;this.annotationLayers=undefined;this.dpi=72;this.originalWidth=0;this.originalHeight=0;this.scrollLeft=null;this.scrollTop=null;this.searchResults=null};vvDocViewState.prototype.initPageStatesArray=function(B,C){if(!this.pageStates){this.pageStates=new Array(B);for(var A=0;A<B;A+=1){this.pageStates[A]=new vvDocViewStateElement(C)}}};vvDocViewState.prototype.cutPages=function(C,B){var F=[];C.sort(function(H,G){return H-G});var D=0;for(var A=0;A<C.length;A+=1){var E=C[A]-D;F.push(this.pageStates.splice(E,1)[0]);D+=1}this.pageCount-=C.length;this.pageNumber=B;return F};vvDocViewState.prototype.copyPages=function(C){var E=[];C.sort(function(G,F){return G-F});for(var A=0;A<C.length;A+=1){var D=this.pageStates[C[A]];var B=deepObjCopy(D);E.push(B)}return E};vvDocViewState.prototype.pastePages=function(E,D){var C=0;var B=this;for(var A=0;A<E.length;A+=1){this.pageStates.splice(D+C,0,E[A]);C+=1}B.fixAnnPagination()};vvDocViewState.prototype.fixAnnPagination=function(){var C=this;for(var E=0;E<C.layerNames.length;E+=1){for(var A=0;A<C.pageStates.length;A+=1){var D=C.pageStates[A];if(D.annotationLayers){var B=D.annotationLayers[C.layerNames[E]];if(B){B.pageNumber=A;this.getDocumentModel().markLayerDirty(B)}}}}};vvDocViewState.prototype.saveAnnotationLayers=function(B){var M=this;var D=[];for(var K=0;K<M.pageStates.length;K+=1){var J=M.pageStates[K];if(J.annotationLayers){for(var I=0;I<M.layerNames.length;I+=1){var E=J.annotationLayers[M.layerNames[I]];var A=M.getDocumentModel().isLayerDirtyByName(M.layerNames[I]);var H=null;if(E!==undefined){if(A||B){E.pageNumber=K;H='<?xml version="1.0" encoding="ISO-8859-1"?><document xmlns="http://snowbound.com/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://snowbound.com/XMLSchema flexAnn.xsd"><docMeta><docID>DOC_ID</docID><docName>ANNOTATED_FILE_NAME</docName><docDPI>';if(E.docDPI>0){H+=E.docDPI}else{H+=200}H+="</docDPI></docMeta><docLayers><layer/></docLayers><docPages><page><pageMeta><pageNumber>";H+=E.pageNumber+"</pageNumber><pageWidth>";H+=E.pageWidth+"</pageWidth><pageHeight>";H+=E.pageHeight+"</pageHeight><doubleByte>";H+=E.doubleByte+"</doubleByte></pageMeta><pageObjects>";for(var F=0;F<E.anns.length;F++){H+=E.anns[F].toXML()}H+="</pageObjects></page></docPages></document>"}}if(H){D.push({layerName:M.layerNames[I],isRedaction:E.isRedaction,pageNumber:E.pageNumber,layerXML:H})}}}}if(D.length>0){var L="modelJSON="+encodeURIComponent(JSON.stringify(D));var C=vvConfig.servletPath;var G=myFlexSnap.getClientInstanceId();C+="?action=saveAnnotationModel&documentId="+myFlexSnap.getDocumentId()+"&clientInstanceId="+G+"&pageCount="+myFlexSnap.getPageCount();if(vvDefines.cacheBuster===true){C+="&cacheBuster="+Math.random()}$.ajax({type:"POST",url:C,dataType:"json",data:L,success:function(O){if(myFlexSnap.checkServerException(O)===true){return }var P=M.documentModel.model.layerManager.layers;for(var N=0;N<P.length;N+=1){P[N].dirty=false}},error:function(N){if(myFlexSnap.checkServerException(N)===true){return }}})}$("#vvSaveDocumentDialog").dialog("close")};vvDocViewState.prototype.rotateLayersForPage=function(D,H){if(isNaN(D)){D=0}var F=this.pageStates[D];if(F.annotationLayers){for(var A=0;A<this.layerNames.length;A+=1){var C=F.annotationLayers[this.layerNames[A]];if(C){for(var E=0;E<C.anns.length;E++){C.anns[E].rotate(H);this.getDocumentModel().markLayerDirty(C)}if((Math.abs(H)===90)||(Math.abs(H)===270)){var B=C.pageWidth;var G=C.pageHeight;C.pageHeight=B;C.pageWidth=G}}}}};vvDocViewState.prototype.renameLayer=function(G,E){for(var A=0;A<this.layerNames.length;A+=1){if(this.layerNames[A]===G){this.layerNames[A]=E;break}}for(var C=0;C<this.pageStates.length;C+=1){var B=this.getLayersForPage(C);if(B){var D=B[G];if(D){for(var F=0;F<D.anns.length;F+=1){D.anns[F].setLayerName(name)}D.layerName=E;B[G]=undefined;B[E]=D}}}};vvDocViewState.prototype.deleteLayer=function(C){for(var A=0;A<this.pageStates.length;A+=1){var B=this.getLayersForPage(A);if(B){B[C]=undefined}}};vvDocViewState.prototype.getTabNumber=function(){return this.tabNumber};vvDocViewState.prototype.getClosedTab=function(){return this.closedTab};vvDocViewState.prototype.getDocumentId=function(){return this.documentId};vvDocViewState.prototype.getDisplayName=function(){return this.displayName};vvDocViewState.prototype.getIsSearchable=function(){if(this.getDocumentId().indexOf("VirtualDocument")===0){return false}else{return this.isSearchable}};vvDocViewState.prototype.getDocumentModel=function(){return this.documentModel};vvDocViewState.prototype.getPageCount=function(){return this.pageCount};vvDocViewState.prototype.getPageNumber=function(){return this.pageNumber};vvDocViewState.prototype.getLayerNames=function(){return this.layerNames};vvDocViewState.prototype.getCurrentLayer=function(){var A=this.pageStates[this.getPageNumber()];if(!this.currentLayer||!A.annotationLayers){return null}return A.annotationLayers[this.currentLayer]};vvDocViewState.prototype.getImageObject=function(){return this.imageObject};vvDocViewState.prototype.getRotationForPage=function(A){if(isNaN(A)){A=0}if(this.documentModel){return this.documentModel.model.pageData[A].rotateAngle/100}};vvDocViewState.prototype.getHorizontalFlipForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].flipHorizontal}};vvDocViewState.prototype.getVerticalFlipForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].flipVertical}};vvDocViewState.prototype.getInvertImageForPage=function(A){if(isNaN(A)){A=0}if(this.documentModel){return this.documentModel.model.pageData[A].invertImage}};vvDocViewState.prototype.getZoomForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].zoom}};vvDocViewState.prototype.getZoomModeForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].zoomMode}};vvDocViewState.prototype.getLayersForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].annotationLayers}};vvDocViewState.prototype.getLayerFromPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates&&this.pageStates[A].annotationLayers){return this.pageStates[A].annotationLayers[B]}};vvDocViewState.prototype.getDPIForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].dpi}};vvDocViewState.prototype.getOriginalWidthForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].originalWidth}};vvDocViewState.prototype.getOriginalHeightForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].originalHeight}};vvDocViewState.prototype.getScrollLeftForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].scrollLeft}};vvDocViewState.prototype.getScrollTopForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates){return this.pageStates[A].scrollTop}};vvDocViewState.prototype.setTabNumber=function(A){this.tabNumber=A};vvDocViewState.prototype.setClosedTab=function(A){this.closedTab=A};vvDocViewState.prototype.setDisplayName=function(A){this.displayName=A};vvDocViewState.prototype.setIsSearchable=function(A){this.isSearchable=A};vvDocViewState.prototype.setDocumentModel=function(A){this.documentModel=A};vvDocViewState.prototype.setPageCount=function(A){this.pageCount=A};vvDocViewState.prototype.setPageNumber=function(A){if(isNaN(A)){A=0}this.pageNumber=A};vvDocViewState.prototype.setLayerNames=function(A){this.layerNames=A};vvDocViewState.prototype.setCurrentLayer=function(A){if(A){this.currentLayer=A.layerName}else{this.currentLayer=undefined}};vvDocViewState.prototype.setImageObject=function(A){this.imageObject=A};vvDocViewState.prototype.setRotationForPage=function(A,B){if(isNaN(A)){A=0}if(this.documentModel){if(this.documentModel.model.pageData[A].rotateAngle!==B){this.documentModel.model.pageData[A].rotateAngle=B*100;this.documentModel.setPagesModifiedSinceInit(true)}}};vvDocViewState.prototype.setHorizontalFlipForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].flipHorizontal=B}};vvDocViewState.prototype.setVerticalFlipForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].flipVertical=B}};vvDocViewState.prototype.setInvertImageForPage=function(A,B){if(isNaN(A)){A=0}if(this.documentModel){if(this.documentModel.model.pageData[A].invertImage!==B){this.documentModel.model.pageData[A].invertImage=B;this.documentModel.setPagesModifiedSinceInit(true)}}};vvDocViewState.prototype.setZoomForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].zoom=B}};vvDocViewState.prototype.setZoomModeForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].zoomMode=B}};vvDocViewState.prototype.setLayersForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].annotationLayers=B}};vvDocViewState.prototype.addLayerToPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){if(!this.pageStates[A].annotationLayers){this.setLayersForPage(A,{})}this.pageStates[A].annotationLayers[B.layerName]=B}};vvDocViewState.prototype.setDPIForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].dpi=B}};vvDocViewState.prototype.setOriginalWidthForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].originalWidth=B}};vvDocViewState.prototype.setOriginalHeightForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].originalHeight=B}};vvDocViewState.prototype.setScrollLeftForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].scrollLeft=B}};vvDocViewState.prototype.setScrollTopForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates){this.pageStates[A].scrollTop=B}};vvDocViewState.prototype.resetAfterSave=function(){for(var A=0;A<this.pageCount;A+=1){this.setRotationForPage(A,0);this.setImageObject(null)}};vvDocViewState.prototype.getSearchResultsForPage=function(A){if(isNaN(A)){A=0}if(this.pageStates&&this.pageStates[A]){return this.pageStates[A].searchResults}};vvDocViewState.prototype.setSearchResultsForPage=function(A,B){if(isNaN(A)){A=0}if(this.pageStates&&this.pageStates[A]){this.pageStates[A].searchResults=B}};vvDocViewState.prototype.addSearchResults=function(B){for(var A=0;A<B.length;A+=1){if(B[A].matches.length>0){this.setSearchResultsForPage(B[A].pageNumber,B[A]);if((this.firstSearchPage===undefined)||(this.firstSearchPage===null)){this.firstSearchPage=B[A].pageNumber}if((this.lastSearchPage===undefined)||(this.lastSearchPage===null)){this.lastSearchPage=B[A].pageNumber}if(B[A].pageNumber<this.firstSearchPage){this.firstSearchPage=B[A].pageNumber}if(B[A].pageNumber>this.lastSearchPage){this.lastSearchPage=B[A].pageNumber}}else{this.setSearchResultsForPage(B[A].pageNumber,undefined)}}};vvDocViewState.prototype.getFirstSearchResultPage=function(){return this.firstSearchPage};vvDocViewState.prototype.getLastSearchResultPage=function(){return this.lastSearchPage};vvDocViewState.prototype.clearSearchResults=function(){this.firstSearchPage=null;this.lastSearchPage=null;for(var A=0;A<this.pageCount;A+=1){this.setSearchResultsForPage(A,null)}};