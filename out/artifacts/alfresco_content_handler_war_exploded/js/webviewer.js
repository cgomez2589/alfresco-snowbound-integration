var myFlexSnap=new FlexSnapAjax();var dragging=false;var dragStartTop;var dragStartLeft;var dragStopTop;var dragStopLeft;var rotateAngle=0;var annDragging=false;var annCorner=null;var annLineEnd=null;var pointArray=null;var waitDialogTimeoutId=null;var zoomToOffset=false;var zoomOffsetTopVal=0;var zoomOffsetLeftVal=0;function FlexSnapAjax(){var Av=this;var BQ="resources/loader.gif";var E=0;var R=0;this.currentStamp=null;var M=null;this.documentList=[];this.openDocuments={};this.recentlyViewedList=[];this.activeTab=0;this.tabs=[];var AW="";var Aj=0;var AP=false;var AE=false;var Aa=false;var A4=false;var l=false;var BR=false;var j=0;var An=100;var Ak=vvConfig.defaultZoomMode;var K=0;var AZ=0;var F=null;var Am=0;var Ai=0;var Y=0;var r=null;var BA=null;var AR=null;var U="";var AD=false;var As=null;var Ay=null;var W=null;var A5=null;var Az=null;var AT=null;var e=null;var BL=null;var B=null;var p=null;var Ar=null;var n=false;var S=null;var z=null;var v=null;var BM=0;var Ax=false;FlexSnapAjax.prototype.init=function(BS){$("[rel*=localize]").localize("vv",vvDefines.localizeOptions);Av.windowWidth=$(window).width();Av.windowHeight=$(window).height();$("#imageControlsDiv").children().tooltip();$("#annToolbar").children().tooltip();$("input").tooltip();this.initToolbar();var BU=document.getElementById("innerDiv");var BV=document.getElementById("outerDiv");if(BrowserDetect.OS.indexOf("iPhone/iPod")>-1){Av.updateMobileLayout()}if(vvConfig.oneLayerPerAnnotation===true){$("#layerManagerDiv").remove();$("#layerMgr").remove()}X();Ah();if(vvConfig.pageManipulations===true){vvDefines.cacheBuster=true}$("#imageControlsDiv").children().on("selectstart",function(){return false});$("#annToolbar").children().on("selectstart",function(){return false});if(vvConfig.imageScrollBars===true){BV.style.overflow="scroll"}else{BV.style.overflow="hidden"}if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<9)){vvDefines.cacheBuster=true}AH();V();m();Ac();$("#layerManagerActiveLayerField").children("input").each(function(){var BY=$(this).val();$(this).val($("<div />").html(BY).text())});$("#vvJumpToPageInput").bind("click",function(BY){$("#vvJumpToPageInput").select()});$("#vvJumpToPageInput").bind("focusout keyup",function(BZ){var BY=parseInt($("#vvJumpToPageInput").val(),10);if(BZ.type==="focusout"){if(!Av.showingPageErrorDialog){Av.currentMatch=0;Av.setPage(BY-1)}}else{if(BZ.which===10||BZ.which===13){Av.currentMatch=0;Av.setPage(BY-1)}}});J(vvDefines.dragModes.pan);BV.onmouseup=H;if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<9)){BV.ondragstart=function(){return false}}$("body").click(function(BZ){if($(BZ.target).closest("#vvPageThumbsInternal").length===0){var BY=Av.getDocumentModel();if(BY){BY.clearPageSelection()}}});$("#vvPageThumbs").scroll(u);$("#vvDocThumbs").scroll(u);$("#vvSearchResults").scroll(u);$(window).resize(function(BY){if((Av.windowWidth!==$(window).width())&&(Av.windowHeight!==$(window).height())){Av.windowWidth=$(window).width();Av.windowHeight=$(window).height();Av.updateMobileLayout(BY)}});window.onorientationchange=Av.updateMobileLayout;var BW=parseInt(t("zoomPercent"),10);if(isNaN(BW)!==true){Av.zoomPercent=BW}var BT=parseInt(t("rotateAngle"),10);if(isNaN(BT)!==true){rotateAngle=BT}var BX=parseInt(t("pageNumber"),10);if(isNaN(BX)!==true){Aj=BX}else{Aj=0}BR=true;if(vvConfig.multipleDocMode!==vvDefines.multipleDocModes.viewedDocuments){this.requestDocumentList();A8(null,true);Av.loadVisibleThumbs(null,null,true)}if(BS!==false){this.openInTab(Av.getDocumentId())}if(BrowserDetect.OS.indexOf("iPhone/iPod")>-1){setTimeout(Av.updateMobileLayout,0)}};FlexSnapAjax.prototype.initViaURL=function(){Av.setDocumentId(t("documentId"));var BS=t("pageNumber");this.setClientInstanceId(this.parseClientInstanceId());var BT=t("openerHistoryBack");if(BT==="true"){window.opener.history.back(1)}this.init(true);if(BS){this.setPage(parseInt(BS,10))}AM(document.getElementById("imageControlsDiv"));AM(document.getElementById("annToolbar"))};FlexSnapAjax.prototype.initSpecifiedDocuments=function(BT){this.documentList=BT;var BU=t("openerHistoryBack");if(BU==="true"){window.opener.history.back(1)}this.init(false);for(var BS=0;BS<this.documentList.length;BS+=1){this.openInTab(this.documentList[BS])}};var AH=function(){$("#vvWaitIndicator").dialog({modal:true,closeOnEscape:false,draggable:false,resizable:false,width:400,height:100,autoOpen:false,open:function(BS,BT){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});$("#vvSaveDocumentDialog").dialog({modal:true,closeOnEscape:false,draggable:false,resizable:false,autoOpen:false,open:function(BS,BT){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});$("#vvPrintDialog").dialog({modal:true,draggable:false,resizable:false,autoOpen:false,buttons:[{text:getLocalizedValue("printDialog.printButton","Print"),click:function(){if($("#vvPrintAnnotationsSelected").attr("checked")){vvConfig.printBurnAnnotations=true}else{vvConfig.printBurnAnnotations=false}$("#vvPrintFrame").remove();$("#vvPrintFramePanel").remove();var BS=document.createElement("div");BS.name="vvPrintFramePanel";BS.id="vvPrintFramePanel";var BT=document.createElement("iframe");BT.name="vvPrintFrame";BT.id="vvPrintFrame";BT.src="resources/print.html";$("#flexSnapAJAX").append(BS);$("#flexSnapAJAX").append(BT);AO($("#vvPrintFirstPage").val()+"-"+$("#vvPrintLastPage").val());$(this).dialog("close")}},{text:getLocalizedValue("printDialog.cancelButton","Cancel"),click:function(){$(this).dialog("close")}}],title:getLocalizedValue("printDialog.title","Printing Options")});$("#vvPrintAnnotationsSelected").change(function(){if($(this).attr("checked")==="checked"){$("#vvPrintAnnotationsTypeCheckboxes").removeClass("vvPrintAnnotationsDisabled");$("#vvPrintAnnotationsTypeText").removeAttr("disabled");$("#vvPrintAnnotationsTypeNonText").removeAttr("disabled")}else{$("#vvPrintAnnotationsTypeCheckboxes").addClass("vvPrintAnnotationsDisabled");$("#vvPrintAnnotationsTypeText").attr("disabled","disabled");$("#vvPrintAnnotationsTypeNonText").attr("disabled","disabled")}});if(vvConfig.printShowTypeToggles){$("#vvPrintOptionsAnnotationsTypeCheckboxes").show()}else{$("#vvPrintOptionsAnnotationsTypeCheckboxes").hide()}$("#vvExportDialog").dialog({modal:true,draggable:false,resizable:false,autoOpen:false,open:function(BS,BT){if($("#vvExportAnnotationsSelected").attr("checked")){$("#vvExportOriginalSelected").attr("disabled","disabled");$("#vvExportOriginalText").addClass("vvExportDisabled")}else{$("#vvExportOriginalSelected").removeAttr("disabled");$("#vvExportOriginalText").removeClass("vvExportDisabled")}},buttons:[{text:getLocalizedValue("exportDialog.exportButton","Export"),click:function(){if($("#vvExportAnnotationsSelected").attr("checked")){vvConfig.exportBurnAnnotations=true}else{vvConfig.exportBurnAnnotations=false}var BS="Original";if($("#vvExportPDFSelected:checked").val()){BS="PDF"}else{if($("#vvExportTIFFSelected:checked").val()){BS="TIFF"}}AY(BS);Aw(BS);$(this).dialog("close")}},{text:getLocalizedValue("exportDialog.cancelButton","Cancel"),click:function(){$(this).dialog("close")}}],title:getLocalizedValue("exportDialog.title","Select Output Format")});$("#vvExportAnnotationsSelected").change(function(){if($(this).attr("checked")==="checked"){$("#vvExportOriginalSelected").attr("disabled","disabled");$("#vvExportOriginalText").addClass("vvExportDisabled");if($("#vvExportOriginalSelected:checked").val()){$("#vvExportOriginalSelected").removeAttr("checked");$("#vvExportPDFSelected").attr("checked","checked")}}else{$("#vvExportOriginalSelected").removeAttr("disabled");$("#vvExportOriginalText").removeClass("vvExportDisabled")}});$("#vvAboutDialog").dialog({modal:true,draggable:false,resizable:false,autoOpen:false,width:320,title:getLocalizedValue("aboutDialog.productName",vvDefines.productName)+" "+getLocalizedValue("aboutDialog.versionPrefix","v")+vvDefines.productVersion,buttons:[{text:getLocalizedValue("aboutDialog.okButton","OK"),click:function(){$(this).dialog("close")}},{text:getLocalizedValue("aboutDialog.helpButton","Help"),click:function(){window.open(vvConfig.helpURL,vvConfig.helpWindowName,vvConfig.helpWindowParams);$(this).dialog("close")}}]});$("#vvNewDocumentDialog").dialog({modal:true,draggable:false,resizable:false,autoOpen:false,width:400,open:function(BS,BT){$("#vvNewDocumentDialogNameInput").val("");$("#vvNewDocumentDialogError").hide()},buttons:[{text:getLocalizedValue("newDocumentDialog.okButton","OK"),click:function(){Av.createNewDocument()}},{text:getLocalizedValue("newDocumentDialog.cancelButton","Cancel"),click:function(){$(this).dialog("close")}}],title:getLocalizedValue("newDocumentDialog.title","Create New Document")});$("#vvNewDocumentDialogNameInput").keyup(function(BS){if(A(BS)){Av.createNewDocument()}});$("#vvAboutDialogText").html(getLocalizedValue("aboutDialog.text",vvDefines.aboutDialogTextContents))};var V=function(){$("#vvThumbsTabs").css("visibility","visible");$("#vvSearch").css("visibility","visible");$("#vvThumbs").tabs();if((vvConfig.showThumbnailPanel===false)||((vvConfig.showPageThumbnails===false)&&(vvConfig.showDocThumbnails===false)&&(vvConfig.showSearch===false))){myFlexSnap.toggleThumbnailPanel(false)}if(vvConfig.showPageThumbnails===false){$("#vvPageThumbsTab").hide();$("#vvThumbs").tabs("select",1)}if(vvConfig.showDocThumbnails===false){$("#vvDocThumbsTab").hide()}if(vvConfig.showSearch===false){$("#vvSearchTab").hide()}$("#vvImagePanel").tabs({tabTemplate:"<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close vvTabCloseButton'>Remove Tab</span></li>",show:function(BT,BU){var BS=$("#vvImagePanel").tabs("option","selected");if(Av.activeTab!==BS){Av.switchToTab(Av.getStateForDocumentId(Av.tabs[BS]))}},add:function(BS,BT){var BU=$(BT.tab).parent().children(".vvTabCloseButton");$(BU).click(function(){var BW=this.parentElement.parentElement;var BV=$(BW).children().index(this.parentElement);Av.closeTab(BV)})}});$("#vvThumbs").bind("tabsshow",function(BS,BU){var BT=Av.getStateForDocumentId(Av.getDocumentId());if(BU.index===0){Av.loadVisibleThumbs(null,BT,false,false);q()}else{if(BU.index===1){Av.loadVisibleThumbs(null,BT,true,false);BN()}else{Av.loadVisibleThumbs(null,BT,false,true);Ap()}}});$("#vvImagePanel").bind("tabsremove",function(BT,BU){var BS=$("#vvImagePanel").tabs("length");if(BS<2){$(".vvTabCloseButton").hide()}})};var Af=function(BT){if(!BT.getIsSearchable()){$("#vvThumbs").tabs("disable",2);var BS=getLocalizedValue("errors.searchNotSearchable","Document is not searchable.");$("#vvSearchTab").attr("title",BS).tooltip()}else{$("#vvThumbs").tabs("enable",2);$("#vvSearchTab").attr("title",undefined).tooltip()}};var m=function(){var BT=$("#vvAnnColorGrid");if(BT.length===0){BT=myFlexSnap.createColorGrid("vvAnnColorGrid","000000")}$(".vvAnnPopUpButton").each(function(){var BV=$(this).val();$(this).val($("<div />").html(BV).text())});$("#vvAnnBorderColorLabel").hide();$("#vvAnnFillColorLabel").hide();$("#vvAnnTextColorLabel").hide();$("#vvAnnBorderSizeLabel").hide();$("#vvAnnColorMoreLink").before(BT);$(".vvAnnColorGridSecondaryRow").hide();$("#vvAnnColorCustom").hide();$("#vvAnnColor").addClass("vvAnnColorLess");$("#vvAnnColorMoreLink").addClass("vvAnnColorLess");for(var BS=0;BS<vvDefines.fontNames.length;BS+=1){$("#vvAnnTextFaceSelect").append("<option>"+vvDefines.fontNames[BS]+"</option>")}for(var BU=0;BU<vvDefines.fontSizes.length;BU+=1){$("#vvAnnTextSizeSelect").append("<option>"+vvDefines.fontSizes[BU]+"</option>")}$("#vvAnnColorMoreLink").click(function(){$("#vvAnnColor").removeClass("vvAnnColorLess");$(".vvAnnColorGridSecondaryRow").show();$("#vvAnnColorMoreLink").hide();$("#vvAnnColorCustom").show()});$(".vvAnnThicknessCell").click(function(){var BV=$(this).children(".vvAnnThicknessElement").css("width");BV=parseInt(BV.replace(/px/i,""),10);$("#vvAnnLineSizeValue").html(BV);$("#vvAnnBorderSizeValue").html(BV);myFlexSnap.getCurrentAnnObject().setLineWidth(BV);myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()});$("#vvAnnTextFaceValue").change(function(BV){myFlexSnap.getCurrentAnnObject().setFontName($(BV.target).val());myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()});$("#vvAnnTextSizeValue").change(function(BV){myFlexSnap.getCurrentAnnObject().setFontSize($(BV.target).val());myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()});$("#vvAnnTextStyle").change(function(BW){var BV=myFlexSnap.getCurrentAnnObject();if($("#vvAnnTextStyleBold").attr("checked")){BV.fontBold=true}else{BV.fontBold=false}if($("#vvAnnTextStyleItalic").attr("checked")){BV.fontItalic=true}else{BV.fontItalic=false}if($("#vvAnnTextStyleUnderline").attr("checked")){BV.fontUnderline=true}else{BV.fontUnderline=false}myPainter.markLayerWithAnnDirty(BV);myPainter.paintAnnotations()});$("#vvAnnTextEditButton").click(function(Be){var BV=Av.getCurrentAnnObject();var Bd=BV.getTextString();$("#vvAnnPopUp").hide();var BW="vvTextAnnotation-"+BV.getLayerName().replace(" ","_")+BV.getOrdinal();var Ba=$("#"+BW);var BZ=Ba.width();var BY=Ba.height();Ba.empty();Ba.append("<textarea id='"+BW+"edit'>"+Bd+"</textarea>");var Bc=$("#"+BW+"edit");Bc.addClass("vvTextAnnEditTextArea");Bc.width(BZ);Bc.height(BY);Bc.css("color",Ba.css("color"));Bc.css("font-family",Ba.css("font-family"));Bc.css("font-size",Ba.css("font-size"));Bc.focus();Bc.select();$(".vvTextAnnEditOkButton").remove();$(".vvTextAnnEditCancelButton").remove();$("#innerDiv").append("<button id='"+BW+"edit-ok'></button>");var Bb=$("#"+BW+"edit-ok");$("#innerDiv").append("<button id='"+BW+"edit-cancel'></button>");var BX=$("#"+BW+"edit-cancel");Bb.addClass("vvTextAnnEditOkButton");BX.addClass("vvTextAnnEditCancelButton");BX.css("z-index","101");BX.position({of:$("#"+BW),my:"right top",at:"right bottom"});Bb.css("z-index","101");Bb.position({of:BX,my:"right",at:"left",offset:"-4 0"});Av.setCurrentAnnObject(null);AB();J(vvDefines.dragModes.textAnnotationEdit);Bb.click(function(Bf){J(vvDefines.dragModes.pan);AB();BV.setTextString($("#"+BW+"edit").val());myPainter.markLayerWithAnnDirty(BV);myPainter.paintAnnotations();$("#"+BW+"edit").remove();Bb.remove();BX.remove();myPainter.paintAnnotations();Bf.stopImmediatePropagation()});BX.click(function(Bf){J(vvDefines.dragModes.pan);AB();myPainter.paintAnnotations();$("#"+BW+"edit").remove();Bb.remove();BX.remove();Bf.stopImmediatePropagation()})});$("#vvAnnDeleteButton").click(function(BV){var BW=Av.getCurrentAnnObject();var BX=getLocalizedValue("deleteAnnDialog.title","Delete Annotation?");$("#vvDeleteAnnotationDialog").dialog({resizable:false,modal:true,title:BX,buttons:[{text:getLocalizedValue("deleteAnnDialog.deleteButton","Delete"),click:function(){$("#vvAnnPopUp").hide();if(BW){BW.setDelete(true);myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject())}AB();myPainter.paintAnnotations();$(this).dialog("close")}},{text:getLocalizedValue("deleteAnnDialog.cancelButton","Cancel"),click:function(){$(this).dialog("close")}}]})});$("#vvAnnColorCustomInput").bind("focusout keyup",function(BX){var BW=/^([a-fA-F0-9]{6})$/;var BV=$("#vvAnnColorCustomInput").attr("value");if(BW.test(BV)){$("#vvAnnColorCustomInput").css("background-color","white");BK(null,null,null,BV);myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()}else{$("#vvAnnColorCustomInput").css("background-color","#F9CECE")}})};var Ac=function(){var BS=Av.getStateForDocumentId(Av.getDocumentId());$("#vvSearchProgress").hide();$("#vvSearchProgress").progressbar();$(".vvSearchButton").button({disabled:true});$("#vvSearchStart").click(function(BU){var BT=$("#vvSearchTermField").val();Av.searchText(BT)});$("#vvSearchTermField").clearableTextField();$("#vvSearchTermField").on("textFieldCleared",function(){Av.clearSearchResults(BS)});$("#vvSearchTermField").change(function(BT){Ag()});$("#vvSearchTermField").bind("keyup",function(BU){var BT=$("#vvSearchTermField").val();Ag();if(BU.which===10||BU.which===13){Av.searchText(BT)}});$("#vvSearchPrevious").click(function(){Av.previousSearchResult()});$("#vvSearchNext").click(function(){Av.nextSearchResult()});$("#vvSearchProgressCancel").click(function(){Av.cancelCurrentSearch()});$("#vvSearchNextPreviousButtons > input").mousedown(function(){$(this).toggleClass("mouseDown")});$("#vvSearchNextPreviousButtons > input").mouseup(function(){$(this).toggleClass("mouseDown")})};var Ag=function(){if($("#vvSearchTermField").val()===""){$("#vvSearchStart").button({disabled:true})}else{$("#vvSearchStart").button({disabled:false})}};var b=function(){var BU=Av.getStateForDocumentId(Av.getDocumentId());var BV=BU.getPageNumber();var BW=BU.getFirstSearchResultPage();var BT=BU.getLastSearchResultPage();if(BW>BV){$("#vvSearchPrevious").button({disabled:true})}else{if(BW===BV){if(Av.currentMatch===0){$("#vvSearchPrevious").button({disabled:true})}else{$("#vvSearchPrevious").button({disabled:false})}}else{$("#vvSearchPrevious").button({disabled:false})}}var BS=BU.getSearchResultsForPage(BT);if(BT<BV){$("#vvSearchNext").button({disabled:true})}else{if(BT===BV){if(Av.currentMatch<(BS.matches.length-1)){$("#vvSearchNext").button({disabled:false})}else{$("#vvSearchNext").button({disabled:true})}}else{$("#vvSearchNext").button({disabled:false})}}};FlexSnapAjax.prototype.createNewDocument=function(BS){Av.copySelection();if(BS){Av.openInTab(BS,true)}else{BS=$("#vvNewDocumentDialogNameInput").val();if(BS===""){$("#vvNewDocumentDialogError").show()}else{Av.openInTab(BS,true);$("#vvNewDocumentDialog").dialog("close")}}};var Ah=function(){for(var BS=0;BS<vvConfig.rubberStamp.length;BS+=1){$("#vvTextAnnContextMenuList").append('<li id="vvTextAnnContextMenuListItem'+BS+'">'+vvConfig.rubberStamp[BS].textString+"</li>");$("#vvTextAnnContextMenuListItem"+BS).click(function(){var BT=$(this).closest("li").index();Av.currentStamp=BT-1;myFlexSnap.addAnnotation("Rubber Stamp");$("#jqContextMenu").hide();$("#jqContextMenuShadow").hide()})}if(vvConfig.enableRubberStamp===true){$("#annTextEdit").contextMenu("vvTextAnnContextMenu",{bindings:{vvTextAnnContextMenuAdd:function(BT){Av.currentStamp=null;myFlexSnap.addAnnotation("Rubber Stamp")}},bindTarget:"click",onContextMenu:function(BT){return true},onShowMenu:function(BT,BU){return BU}})}else{$("#annTextEdit").click(function(){myFlexSnap.addAnnotation("Rubber Stamp")})}};FlexSnapAjax.prototype.openInTab=function(BT,BY){if(!BT){return }var Bc=Av.getDocumentId();var BV=Aj;var Bb=this.getOpenDocuments();var BW=Av.getStateForDocumentId(Bc);var BS=Av.getStateForDocumentId(BT);A1();this.addToRecentlyViewed(BT);if(vvConfig.multipleDocMode===vvDefines.multipleDocModes.viewedDocuments){this.requestDocumentList();A8(BS,true)}if(BW){BW.setPageNumber(BV)}if(this.tabs.length>=vvDefines.maxNumberOfTabs){alert(getLocalizedValue("errors.tabTooManyOpen","Too many open tabs."));return }var BU=null;var Be=false;var Ba=false;var BX=false;for(var Bd=0;Bd<this.tabs.length;Bd+=1){if(this.tabs[Bd]===BT){Be=true}}if(BS){BU=BS.getTabNumber();Ba=BS.getClosedTab()}else{BX=true;BS=new vvDocViewState(BT,null,null,0,this.tabs.length,vvConfig.defaultZoomMode);Av.setStateForDocumentId(BT,BS)}if(BX||(Be===false)||(Ba===true)){BU=this.tabs.length;this.tabs[BU]=BT;$("#vvImagePanel").tabs("add","resources/blank.html",BT);var BZ=$("#vvImagePanel").tabs("length");if(BZ>1){$(".vvTabCloseButton").show()}else{$(".vvTabCloseButton").hide()}if(BS){BS.setTabNumber(BU);BS.setClosedTab(false)}}else{BU=BS.getTabNumber()}this.switchToTab(BS,BY)};FlexSnapAjax.prototype.updateTabName=function(BS,BT){var BU=$("#imageTabs").find($("a"))[BS];$("#imageTabs").find(BU).html(BT)};FlexSnapAjax.prototype.addToRecentlyViewed=function(BS){this.removeFromRecentlyViewed(BS);if(this.recentlyViewedList.length===vvDefines.mostRecentlyViewedListLength){this.recentlyViewedList.pop()}this.recentlyViewedList.unshift(BS);P()};FlexSnapAjax.prototype.removeFromRecentlyViewed=function(BU){for(var BS=0;BS<this.recentlyViewedList.length;BS+=1){var BT=this.recentlyViewedList[BS];if(BT===BU){this.recentlyViewedList.splice(BS,1);break}}P()};var P=function(){var BT=new Date();BT.setDate(BT.getDate()+365);var BU="";for(var BS=0;BS<Av.recentlyViewedList.length;BS+=1){BU+=encodeURIComponent(Av.recentlyViewedList[BS]);if(BS!==(Av.recentlyViewedList.length-1)){BU+=","}}document.cookie="recentlyViewedList="+encodeURIComponent(BU)+";expires="+BT.toGMTString()};var A1=function(){var BV="recentlyViewedList";if(document.cookie.length>0){var BT=document.cookie.indexOf(BV+"=");var BU=-1;if(BT!==-1){BT+=BV.length+1;BU=document.cookie.indexOf(";",BT);if(BU===-1){BU=document.cookie.length}Av.recentlyViewedList=decodeURIComponent(document.cookie.substring(BT,BU)).split(",");for(var BS=0;BS<Av.recentlyViewedList.length;BS+=1){Av.recentlyViewedList[BS]=decodeURIComponent(Av.recentlyViewedList[BS]);if(!Av.recentlyViewedList[BS]){Av.recentlyViewedList.splice(BS,1)}}return true}else{return false}}else{return false}};FlexSnapAjax.prototype.switchToTab=function(BW,BV){myPainter.clearAnnotations();AB();this.setCurrentAnnObject(null);$("#vvAnnPopUp").hide();var BU=Av.getPageNumber();var BX=Av.getDocumentId();var BT=Av.getStateForDocumentId(BX);AI(false,false);Av.cancelCurrentSearch();Av.clearSearchResults(BT);if(($("#vvThumbs").tabs("option","selected")===2)&&(!BW.getIsSearchable())){$("#vvThumbs").tabs("select",0)}Af(BW);A6(BU);if(BT){BT.setPageNumber(BU)}if(vvConfig.fitLastBetweenDocuments===false){if(vvConfig.defaultZoomMode===vvDefines.zoomModes.fitLast){Av.zoomMode=vvDefines.zoomModes.fitWindow}else{Av.zoomMode=vvConfig.defaultZoomMode}}var BS=this.tabs[BW.getTabNumber()];Av.setDocumentId(BS);Aj=BW.getPageNumber();this.requestDocumentModel(BW,false,BV,BT);A6(null);BE();A9(true);AV();AU();this.selectTab(BW)};FlexSnapAjax.prototype.selectTab=function(BT){var BS=BT.getTabNumber();if((BS<0)||(BS>this.tabs.length)){alert(getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."));return }$("#vvImagePanel").tabs("select",BS);this.activeTab=BS};FlexSnapAjax.prototype.closeTab=function(BS,BU){if((BS<0)||(BS>=this.tabs.length)){alert(getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."));return }if((this.tabs.length===1)&&(BU===false)){alert(getLocalizedValue("errors.tabCloseLastTab","Closing last tab is not allowed."));return }$("#vvImagePanel").tabs("remove",BS);var BT=Av.getStateForDocumentId(this.tabs[BS]);if(BT){BT.setTabNumber(null);BT.setClosedTab(true)}this.tabs.splice(BS,1);for(x=BS;x<this.tabs.length;x+=1){BT=Av.getStateForDocumentId(this.tabs[x]);BT.setTabNumber(x)}if(this.activeTab>=BS){this.activeTab-=1;if(this.activeTab<0){this.activeTab=0}this.switchToTab(Av.getStateForDocumentId(Av.tabs[Av.activeTab]))}};FlexSnapAjax.prototype.parseClientInstanceId=function(){var BS="clientInstanceId";var BT=document.cookie.indexOf(BS+"=");var BU=null;if(BT!==-1){BT=BT+BS.length+1;cookieend=document.cookie.indexOf(";",BT);if(cookieend===-1){c_end=document.cookie.length}BU=decodeURIComponent(document.cookie.substring(BT,cookieend))}if(!BU){BU=t("clientInstanceId")}return BU};FlexSnapAjax.prototype.getClientInstanceId=function(){return this.clientInstanceId};FlexSnapAjax.prototype.setClientInstanceId=function(BS){this.clientInstanceId=BS};FlexSnapAjax.prototype.requestDocumentModel=function(BW,BV,BU,BT){var BS=vvConfig.servletPath+"?action=getDocumentModel&documentId="+BW.getDocumentId()+"&clientInstanceId="+this.getClientInstanceId();if(vvDefines.cacheBuster===true){BS+="&cacheBuster="+Math.random()}if(BU){BS="resources/blank.json"}if(BW.getDocumentModel()&&!BV){Av.processDocumentModel(BW,BU,BT);return }AT=null;$.ajax({url:BS,async:false,dataType:"json",success:function(BY){if(BJ(BY)===true){return }var BX=new DocumentModel(BY);BW.setDocumentModel(BX);Av.processDocumentModel(BW,BU,BT)},error:function(BX){console.log("error")}})};FlexSnapAjax.prototype.requestDocumentList=function(){var BT=Av.getStateForDocumentId(Av.getDocumentId());var BS=vvConfig.servletPath+"?action=getDocumentList&clientInstanceId="+this.getClientInstanceId();if(vvDefines.cacheBuster===true){BS+="&cacheBuster="+Math.random()}if(vvConfig.multipleDocMode===vvDefines.multipleDocModes.availableDocuments){$.ajax({url:BS,dataType:"json",success:function(BU){if(BJ(BU)===true){return }Av.documentList=BU.documentList;A8(null,true);BN();Av.loadVisibleThumbs(null,BT,true)},error:function(BU){console.log("error")}})}else{if(vvConfig.multipleDocMode===vvDefines.multipleDocModes.specifiedDocuments){A8(null,true);Av.loadVisibleThumbs(null,BT,true)}else{if(vvConfig.multipleDocMode===vvDefines.multipleDocModes.viewedDocuments){A1();this.documentList=this.recentlyViewedList.slice()}}}};var t=function(BS){var BT="";BT=AA(window.location.href,BS);return BT};var AA=function(BS,BU){var BV="";var BT=BS.match(new RegExp(BU,"i"));var BW=BS.indexOf(BT+"=");if(BW===-1){return null}BV=BS.substring(BW+BU.length+1);BW=BV.indexOf("&");if(BW>-1){BV=BV.slice(0,BW)}return BV};FlexSnapAjax.prototype.processDocumentModel=function(BV,BT,BS){var BY=null;if(BS){BY=BS.getDocumentModel()}var BX=BV.getDocumentModel();var BW=BV.documentId;BX.lastSelectedPageNumber=Aj;j=BX.getDocumentLength();BV.setPageCount(j);AV();A8(BV,false);q();BV.initPageStatesArray(j,vvConfig.defaultZoomMode);if(BT){if(BY){var BU=deepObjCopy(BY.model.layerManager);BX.layerManager=BU}F=null;BX.model.displayName=null;BX.model.documentId=BW;BV.setDisplayName(null);Av.pasteSelection(0,BT)}Aj=BV.getPageNumber();if(isNaN(Aj)){Aj=0}A6(null);if(!BT){O(BV);Av.loadVisibleThumbs(null,BV,false);Av.loadVisibleThumbs(null,BV,true)}myPainter.resetLayers();if(BT){Av.saveDocument(true)}};var s=function(BX,BW){if(!BW){return }var BV=null;var BS=null;var BT=null;var BU=BW.getDocumentId();if(BX){if(BJ(BX)===true){return }BV=BX.imageWidth;BS=BX.imageHeight;BT=BX.imageDPI;isSearchable=BX.isSearchable;F=BX.displayName;BW.setDisplayName(BX.displayName);BW.setIsSearchable(isSearchable);Af(BW);if(BX.displayName){Av.updateTabName(BW.getTabNumber(),BX.displayName)}else{Av.updateTabName(BW.getTabNumber(),BU)}myFlexSnap.setOriginalWidth(BV);myFlexSnap.setOriginalHeight(BS);BW.setDPIForPage(Aj,BT);BW.setOriginalWidthForPage(Aj,K);BW.setOriginalHeightForPage(Aj,AZ)}else{BV=BW.getOriginalWidthForPage(Aj);BS=BW.getOriginalHeightForPage(Aj);F=BW.getDisplayName();myFlexSnap.setOriginalWidth(BV);myFlexSnap.setOriginalHeight(BS);if(F){Av.updateTabName(BW.getTabNumber(),F)}else{Av.updateTabName(BW.getTabNumber(),BU)}}A0();if(BW.getDocumentId()===Av.getDocumentId()){if(AD&&vvDefines.tilesEnabled){A7(BW)}else{Ao(BW)}}};FlexSnapAjax.prototype.checkServerException=function(BS){BJ(BS)};var BJ=function(BT){var BS=BT.exceptionMessage;if(BS&&!Av.currentExceptionDialog){BS=decodeURIComponent(BS);Av.currentExceptionDialog=$("<div>"+BS+"</div>").dialog({modal:true,buttons:{Ok:function(){$(this).dialog("close")}},close:function(BU,BV){Av.currentExceptionDialog=null}});A9(false);return true}else{return false}};FlexSnapAjax.prototype.requestAnnotations=function(BT){var Ba=BT.getDocumentModel();if(!Ba){return }var Be=null;if(BT){Be=BT.getLayersForPage(Aj)}if(Be){if(BT.getCurrentLayer()){BT.setCurrentLayer(Be[BT.getCurrentLayer().layerName])}else{myPainter.getCurrentLayer()}var BV=document.getElementById("vvAnnotationCanvas");if(BV){myPainter.paintAnnotations();myPainter.fillLayerDialog();var BS=Av.getCurrentAnnObject();if(BS){G(BS)}}}else{var BY=Ba.model.layerManager.layers.length;var Bc=BT.getLayerNames();myPainter.clearAnnotations();myPainter.resetLayers(BT);for(var BZ=0;BZ<BY;BZ++){var Bb=unescape(Ba.model.layerManager.layers[BZ].annotationId);var BX=Ba.model.pageData[Aj].annotationHash;if(!BX){Ba.model.pageData[Aj].annotationHash={};BX=Ba.model.pageData[Aj].annotationHash}var BW=BX[Bb];var Bf=false;if(BW){Bf=BW.annExists}if(Bf===true){Bc[BZ]=Bb;var BU=vvConfig.servletPath;BU+="?action=getAnnotationModel&documentId="+BW.documentId+"&clientInstanceId="+this.getClientInstanceId()+"&annotationLayer="+BW.layerAnnotationId+"&pageCount="+BT.getPageCount()+"&pageIndex="+BW.pageIndex;if(vvDefines.cacheBuster===true){BU+="&cacheBuster="+Math.random()}ajax(BU,"",function(Bj,Bh){var Bg=document.getElementById("vvAnnotationCanvas");myPainter.parseLayer(Bh,BT);if(Bg){myPainter.paintAnnotations();myPainter.fillLayerDialog();var Bi=Av.getCurrentAnnObject();if(Bi){G(Bi)}}})}else{var Bd=myPainter.createAnnotationLayer(Bb);BT.setCurrentLayer(Bd);Bc[BZ]=Bb;BT.addLayerToPage(BT.getPageNumber(),Bd)}if(BY===0){myPainter.createDefaultLayer(BT);BT.addLayerToPage(BT.getPageNumber(),myPainter.getCurrentLayer())}}}};var D=function(BX,BU){tileModel=BU;var Ba=BU.getElementsByTagName("status")[0].firstChild.nodeValue;var BY=BU.getElementsByTagName("imageHeight")[0].firstChild.nodeValue;var BS=BU.getElementsByTagName("imageWidth")[0].firstChild.nodeValue;var BT=document.getElementById("innerDiv");var BW=document.getElementById("outerDiv");var BZ=0;var BV=0;if(BS<BW.clientWidth){BV=(BW.clientWidth/2)-(BS/2)}if(BY<BW.clientHeight){BZ=(BW.clientHeight/2)-(BY/2)}if(zoomToOffset){BZ=zoomOffsetTopVal;BV=zoomOffsetLeftVal;zoomToOffset=false}BT.style.top=BZ+"px";BT.style.left=BV+"px";myPainter.paintAnnotations();A2(BY,BS)};var w=function(BS){var BV=document.getElementById("innerDiv");var BU=0;if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<9)){BU=1}if(!BS){BS=window.event}AQ();if(vvConfig.imageScrollBars===false){if(BS.button===BU){dragStartLeft=BS.clientX;dragStartTop=BS.clientY;var BT=document.getElementById("vvRubberbandCanvas");var Ba=BT.getContext("2d");var BW=BI(BV);var BY=document.getElementById("propDiv");var BX=new Point(BS.clientX-BW[0],BS.clientY-BW[1]);var BZ=myPainter.isAnnotationAtPoint(BX);if(BZ===true){cursorNormal()}else{cursorGrabClosed()}E=stripPx(BV.style.top);R=stripPx(BV.style.left);dragging=true;return false}}else{E=stripPx(BV.style.top);R=stripPx(BV.style.left)}};var H=function(BT){if(!BT){BT=window.event}var BV=document.getElementById("innerDiv");dragging=false;if(AD&&vvDefines.tilesEnabled){var BW=stripPx(BV.style.height);var BX=stripPx(BV.style.width);A2(BW,BX)}var BU=document.getElementById("vvRubberbandCanvas");var Bb=BU.getContext("2d");var BY=BI(BV);var Ba=document.getElementById("propDiv");var BZ=new Point(BT.clientX-BY[0],BT.clientY-BY[1]);var BS=myPainter.getAnnotationAtPoint(BZ);if(Av.getCurrentAnnObject()!==BS){$("#vvAnnPopUp").hide()}Av.setCurrentAnnObject(BS);if(BS){cursorNormal();G(BS)}else{cursorGrabOpen();$("#vvAnnPopUp").hide()}};FlexSnapAjax.prototype.buttonDown=function(BT){AQ();var BS=Av.getCurrentAnnObject();value=false;if(BT.indexOf("AddLayer")!==-1){document.getElementById("layerManagerAddLayerButton").style.borderStyle="inset"}else{if(BT.indexOf("DeleteLayer")!==-1){document.getElementById("layerManagerDeleteLayerButton").style.borderStyle="inset"}else{if(BT.indexOf("RenameLayer")!==-1){document.getElementById("layerManagerRenameLayerButton").style.borderStyle="inset"}else{if(BT.indexOf("RedactLayer")!==-1){document.getElementById("layerManagerRedactLayerButton").style.borderStyle="inset"}}}}myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()};FlexSnapAjax.prototype.undoAnnotation=function(){var BS=Av.getCurrentAnnObject();if(BS){BS.copyFrom(this.backupAnnObject);G(BS)}myPainter.paintAnnotations()};FlexSnapAjax.prototype.buttonUp=function(BX){AQ();var BV=myFlexSnap.getStateForDocumentId(Av.getDocumentId());if(BX.indexOf("AddLayer")!==-1){var BT=prompt(getLocalizedValue("addLayerDialog.layerName","Layer Name")+":","");document.getElementById("layerManagerAddLayerButton").style.borderStyle="outset";if(!BT){return }while(Aq(BT)!==true){BT=prompt(getLocalizedValue("errors.invalidLayerName","Invalid layer name. Please choose a new layer name:"),"");if(!BT){break}}if(BT){var BS=BV.getLayerFromPage(BV.getPageNumber(),BT);if(!BS){myPainter.createLayer(BT)}else{alert(getLocalizedValue("errors.layerNameAlreadyExists","A layer with that name already exists."))}}}else{if(BX.indexOf("DeleteLayer")!==-1){document.getElementById("layerManagerDeleteLayerButton").style.borderStyle="outset";if(myPainter.checkLayerPermission(myPainter.getCurrentLayer(),vvDefines.permissionLevels.PERM_DELETE)){if(confirm(getLocalizedValue("deleteLayerDialog.value","Are you sure you wish to delete layer")+": "+myPainter.getCurrentLayer().layerName)){myPainter.deleteCurrentLayer();myPainter.fillLayerDialog()}}else{alert(getLocalizedValue("errors.deleteLayerPermission","You do not have permission to delete this layer."))}}else{if(BX.indexOf("RenameLayer")!==-1){document.getElementById("layerManagerRenameLayerButton").style.borderStyle="outset";if(myPainter.checkLayerPermission(myPainter.getCurrentLayer(),vvDefines.permissionLevels.PERM_DELETE)){var BW=prompt(getLocalizedValue("addLayerDialog.layerName","Layer Name")+":",myPainter.getCurrentLayer().layerName);if(!BW){return }while(Aq(BW)!==true){BW=prompt(getLocalizedValue("errors.invalidLayerName","Invalid layer name. Please choose a new layer name:"),myPainter.getCurrentLayer().layerName);if(!BW){break}}if(BW){var BU=BV.getLayerFromPage(BV.getPageNumber(),BW);if(!BU){myPainter.renameCurrentLayer(BW);myPainter.fillLayerDialog();$("#vvSaveDocumentDialog").dialog("open");BV.saveAnnotationLayers(true)}else{alert(getLocalizedValue("errors.layerNameAlreadyExists","A layer with that name already exists."))}}}else{alert(getLocalizedValue("errors.renameLayerPermission","You do not have permission to rename this layer."))}}else{if(BX.indexOf("RedactLayer")!==-1){if(myPainter.getCurrentLayer().isRedaction===true){document.getElementById("layerManagerRedactLayerButton").style.borderStyle="outset";myPainter.getCurrentLayer().isRedaction=false;myPainter.markCurrentLayerDirty()}else{document.getElementById("layerManagerRedactLayerButton").style.borderStyle="inset";myPainter.getCurrentLayer().isRedaction=true;myPainter.markCurrentLayerDirty()}}}}}};var Ae=function(){if(!AT){AT=0;var BU=Av.getStateForDocumentId(Av.getDocumentId());var BW=BU.getLayerNames();for(var BS=0;BS<BW.length;BS+=1){var BT=BW[BS];var BV=BT.split("-");if(BV){if(BV[0]===vvDefines.autoLayerPrefix){AT=Math.max(parseInt(BV[1],10),AT)}}}AT+=1}myPainter.createLayer(vvDefines.autoLayerPrefix+"-"+AT);AT+=1};var Aq=function(BS){var BT=true;if(BS===""){BT=false}else{if(BS.length>50){BT=false}}return BT};var AU=function(){var BS=vvConfig.servletPath;BS+="?action=eventNotification";BS+="&KEY_EVENT=VALUE_EVENT_PAGE_REQUESTED";BS+="&KEY_DOCUMENT_ID="+Av.getDocumentId();BS+="&clientInstanceId="+myFlexSnap.getClientInstanceId();BS+="&KEY_EVENT_PAGE_REQUESTED_NUMBER="+Aj;if(vvDefines.cacheBuster===true){BS+="&cacheBuster="+Math.random()}$.ajax({url:BS,dataType:"json",success:function(BT){if(BJ(BT)===true){return }},error:function(BT){if(BJ(BT)===true){return }}})};var BC=function(){var BV=vvConfig.servletPath;var BT=Av.getStateForDocumentId(Av.getDocumentId());var BU=BT.getLayerNames();BV+="?action=eventNotification";BV+="&KEY_EVENT=VALUE_EVENT_SAVE_ANNOTATION";BV+="&KEY_DOCUMENT_ID="+Av.getDocumentId();BV+="&clientInstanceId="+myFlexSnap.getClientInstanceId();if(vvDefines.cacheBuster===true){BV+="&cacheBuster="+Math.random()}for(var BS=0;BS<BU.length;BS+=1){BV+="&KEY_EVENT_SAVE_ANNOTATION_LAYER_NAME"+BS+"="+BU[BS]}$.ajax({url:BV,dataType:"json",success:function(BW){if(BJ(BW)===true){return }},error:function(BW){if(BJ(BW)===true){return }}})};var AO=function(BS){var BT=vvConfig.servletPath;BT+="?action=eventNotification";BT+="&KEY_EVENT=VALUE_EVENT_PRINT";BT+="&KEY_DOCUMENT_ID="+Av.getDocumentId();BT+="&clientInstanceId="+myFlexSnap.getClientInstanceId();BT+="&KEY_EVENT_PRINT_PAGE_NUMBERS="+BS;if(vvDefines.cacheBuster===true){BT+="&cacheBuster="+Math.random()}$.ajax({url:BT,dataType:"json",success:function(BU){if(BJ(BU)===true){return }},error:function(BU){if(BJ(BU)===true){return }}})};var Aw=function(BS){var BT=vvConfig.servletPath;BT+="?action=eventNotification";BT+="&KEY_EVENT=VALUE_EVENT_EXPORT";BT+="&KEY_DOCUMENT_ID="+Av.getDocumentId();BT+="&clientInstanceId="+myFlexSnap.getClientInstanceId();BT+="&KEY_EVENT_EXPORT_FORMAT_NAME="+BS;if(vvDefines.cacheBuster===true){BT+="&cacheBuster="+Math.random()}$.ajax({url:BT,dataType:"json",success:function(BU){if(BJ(BU)===true){return }},error:function(BU){if(BJ(BU)===true){return }}})};var Au=function(BS){if(!BS){BS=window.event}if(vvConfig.imageScrollBars===false){var BV=document.getElementById("vvImageCanvas");var BU=document.getElementById("innerDiv");var Bb=document.getElementById("outerDiv");var BW=0;var BX=0;if(AD&&vvDefines.tilesEnabled){BW=stripPx(BU.style.height);BX=stripPx(BU.style.width)}else{if(BV){BW=BV.height;BX=BV.width}}var BT=document.getElementById("vvRubberbandCanvas");if(BT){var Bf=BT.getContext("2d");var BY=BI(BU);var Bc=document.getElementById("propDiv");var Ba=new Point(BS.clientX-BY[0],BS.clientY-BY[1]);var Be=myPainter.isAnnotationAtPoint(Ba);if(Be===true){cursorNormal()}else{if(dragging){cursorGrabClosed()}else{cursorGrabOpen()}}}if(dragging){var Bd=E+(BS.clientY-dragStartTop);var BZ=R+(BS.clientX-dragStartLeft);if(BX>Bb.clientWidth){if(BZ>0){BZ=0}else{if((BX+BZ)<Bb.clientWidth){BZ=Bb.clientWidth-BX}}}else{BZ=(Bb.clientWidth/2)-(BX/2)}if(BW>Bb.clientHeight){if(Bd>0){Bd=0}else{if((BW+Bd)<Bb.clientHeight){Bd=Bb.clientHeight-BW}}}else{Bd=(Bb.clientHeight/2)-(BW/2)}BU.style.top=Bd+"px";BU.style.left=BZ+"px";if(AD&&vvDefines.tilesEnabled){A2(BW,BX)}}}};var BG=function(BV){var BX=document.getElementById("innerDiv");var BW=document.getElementById("vvRubberbandCanvas");if(!BV){BV=window.event}AQ();var BT=myFlexSnap.getCurrentAnnObject();if(!BT){Av.setCurrentAnnObject(null);AB();J(vvDefines.dragModes.pan);return false}var BZ=BT.getBoundingBox();var Bb=BI(BX);var BU=BV.clientX-Bb[0];var BS=BV.clientY-Bb[1];var Be=BT.getWidthRatio();var BY=BT.getHeightRatio();var Bd=new Point(BU,BS);if(BZ.contains(Bd,Be,BY)===false){Av.setCurrentAnnObject(null);AB();J(vvDefines.dragModes.pan);return false}z=BU-BT.box.one.getX()*BT.getWidthRatio();v=BS-BT.box.one.getY()*BT.getHeightRatio();Bb=BI(BX);var Bc=Math.round(BV.clientX-Bb[0]);var Ba=Math.round(BV.clientY-Bb[1]);annDragging=true;if((BT.getType()===vvDefines.annotationTypes.SANN_ARROW)||(BT.getType()===vvDefines.annotationTypes.SANN_LINE)){annLineEnd=BT.findLineEndpoint(Bd,BT.getWidthRatio(),BT.getHeightRatio())}else{annCorner=BZ.findCorner(Bd,Be,BY)}return false};var AB=function(){var BT=document.getElementById("vvRubberbandCanvas");if(BT){var BS=BT.getContext("2d");BS.clearRect(0,0,BT.width,BT.height)}};var BD=function(BS){if(!BS){BS=window.event}annDragging=false;annCorner=null;annLineEnd=null;myFlexSnap.getCurrentAnnObject().fixBoundingBox();myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations();J(vvDefines.dragModes.pan);AB();if(myPainter.checkLayerPermission(myPainter.getCurrentLayer(),vvDefines.permissionLevels.PERM_EDIT)===false){alert(getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer."));myFlexSnap.undoAnnotation()}return false};var L=function(BT){var BV=document.getElementById("innerDiv");var BU=document.getElementById("vvRubberbandCanvas");var Bb=BU.getContext("2d");if(!BT){BT=window.event}if(annDragging){var BY=BI(BV);var BS=myFlexSnap.getCurrentAnnObject();var Ba=Math.round(BT.clientX-BY[0]);var BZ=Math.round(BT.clientY-BY[1]);var BX=new Point(Ba-z,BZ-v);var BW=new Point(Ba,BZ);if(BX.getX()<0){BX=new Point(0,BX.getY())}else{if(BX.getX()+BS.box.getWidth()*BS.getWidthRatio()>$("#innerDiv").width()){BX=new Point($("#innerDiv").width()-BS.box.getWidth()*BS.getWidthRatio(),BX.getY())}}if(BX.getY()<0){BX=new Point(BX.getX(),0)}else{if(BX.getY()+BS.box.getHeight()*BS.getHeightRatio()>$("#innerDiv").height()){BX=new Point(BX.getX(),$("#innerDiv").height()-BS.box.getHeight()*BS.getHeightRatio())}}if(annCorner||annLineEnd){if((myFlexSnap.getCurrentAnnObject().getType()===vvDefines.annotationTypes.SANN_ARROW)||(myFlexSnap.getCurrentAnnObject().getType()===vvDefines.annotationTypes.SANN_LINE)){myFlexSnap.getCurrentAnnObject().stretchLine(annLineEnd,BW.getX(),BW.getY())}else{myFlexSnap.getCurrentAnnObject().stretch(annCorner,BW.getX(),BW.getY())}}else{myFlexSnap.getCurrentAnnObject().move(BX)}myPainter.markLayerWithAnnDirty(myFlexSnap.getCurrentAnnObject());G(myFlexSnap.getCurrentAnnObject());myPainter.paintAnnotations()}return false};var c=function(BT){var BS=document.getElementById("innerDiv");AQ();pointArray=[];if(!BT){BT=window.event}pos=BI(BS);dragStartLeft=BT.clientX-pos[0];dragStartTop=BT.clientY-pos[1];pointArray[0]=new Point(dragStartLeft,dragStartTop);Y=1;E=stripPx(BS.style.top);R=stripPx(BS.style.left);dragging=true;return false};var d=function(BW){var BV=document.getElementById("innerDiv");var BU=document.getElementById("vvRubberbandCanvas");var BT=BU.getContext("2d");var BY=document.getElementById("vvAnnotationCanvas");var BS=BY.getContext("2d");if(!BW){BW=window.event}dragging=false;pos=BI(BV);dragStopLeft=BW.clientX-pos[0];dragStopTop=BW.clientY-pos[1];AF(BU);BT.clearRect(0,0,BU.width,BU.height);var BX=AC(true);BX.setPreview(false);if(vvConfig.oneLayerPerAnnotation===true){Ae()}if(((BX.getType()===vvDefines.annotationTypes.SANN_ARROW)||(BX.getType()===vvDefines.annotationTypes.SANN_LINE))&&(pointArray.length<2)){J(vvDefines.dragModes.pan);pointArray=null;return false}myPainter.addAnnotation(BX);myPainter.paintAnnotations();J(vvDefines.dragModes.pan);pointArray=null;return false};var a=function(BV){var BU=document.getElementById("vvRubberbandCanvas");var BT=BU.getContext("2d");if(!BV){BV=window.event}pos=BI(document.getElementById("innerDiv"));if(dragging===true){dragStopLeft=BV.clientX-pos[0];dragStopTop=BV.clientY-pos[1];AF(BU);BT.clearRect(0,0,BU.width,BU.height);var BS=new Point(dragStopLeft,dragStopTop);if(Az===vvDefines.annotationTypes.SANN_FREEHAND){pointArray[pointArray.length]=BS}else{pointArray[Y]=BS}if(pointArray.length>1){var BW=AC();myPainter.paintAnnotation(BU,BW)}}return false};var Al=function(BT){var BZ=document.getElementById("outerDiv");var BU=document.getElementById("vvRubberbandCanvas");var Bb=BU.getContext("2d");var Ba,BX,BW,BV;if(!BT){BT=window.event}pos=BI(document.getElementById("innerDiv"));if(dragging===true){dragStopLeft=BT.clientX-pos[0];dragStopTop=BT.clientY-pos[1];AF(BU);BW=Math.abs(dragStopTop-dragStartTop);BX=Math.abs(dragStopLeft-dragStartTop);Bb.clearRect(0,0,BU.width,BU.height);var BY=new Point(dragStopLeft,dragStopTop);if(Az===vvDefines.annotationTypes.SANN_FREEHAND){pointArray[pointArray.length]=BY}else{pointArray[Y]=BY}if(pointArray.length>1){var BS=AC();myPainter.paintAnnotation(BU,BS)}}return false};var Ab=function(BU){var BW=document.getElementById("innerDiv");var Ba=document.getElementById("outerDiv");var Bb=document.getElementById("vvRubberbandCanvas");var BT=Bb.getContext("2d");if(!BU){BU=window.event}dragging=false;pos=BI(BW);dragStopLeft=BU.clientX-pos[0];dragStopTop=BU.clientY-pos[1];AF(Bb);BT.clearRect(0,0,Bb.width,Bb.height);var BS=AC(true);BS.setPreview(false);J(vvDefines.dragModes.pan);pointArray=null;Av.zoomMode=vvDefines.zoomModes.fitCustom;if((Am<1)||(Ai<1)){alert("Cannot zoom out any further");return }var Bc=Math.abs(dragStopTop-dragStartTop);var BV=Math.abs(dragStopLeft-dragStartLeft);var BX,BZ,BY;if(Bc>=BV){BY=Ba.clientHeight/Bc;imgScaleRatio=Ai/Bc}else{BY=Ba.clientWidth/BV;imgScaleRatio=Ai/Bc}Av.zoomPercent=Math.round(Av.zoomPercent*BY);if(Av.zoomPercent>vvConfig.maxZoomPercent){Av.zoomPercent=vvConfig.maxZoomPercent;Ai=Math.round(Ai*(vvConfig.maxZoomPercent/100));Am=Math.round(Am*(vvConfig.maxZoomPercent/100))}else{Ai=Math.round(Ai*BY);Am=Math.round(Am*BY)}if(dragStopLeft<dragStartLeft&&dragStopTop<dragStartTop){zoomOffsetTopVal=dragStopTop*BY;zoomOffsetLeftVal=dragStopLeft*BY}else{if(dragStopLeft<dragStartLeft&&dragStopTop>dragStartTop){zoomOffsetTopVal=dragStartTop*BY;zoomOffsetLeftVal=dragStopLeft*BY}else{if(dragStopLeft>dragStartLeft&&dragStopTop<dragStartTop){zoomOffsetTopVal=dragStopTop*BY;zoomOffsetLeftVal=dragStartLeft*BY}else{zoomOffsetTopVal=dragStartTop*BY;zoomOffsetLeftVal=dragStartLeft*BY}}}if((Am-zoomOffsetLeftVal)<Ba.clientWidth){delta=Ba.clientWidth-(Am-zoomOffsetLeftVal);zoomOffsetLeftVal=zoomOffsetLeftVal-delta;if(zoomOffsetLeftVal<0){zoomOffsetLeftVal=zoomOffsetLeftVal/2}}if((Ai-zoomOffsetTopVal)<Ba.clientHeight){delta=Ba.clientHeight-(Ai-zoomOffsetTopVal);zoomOffsetTopVal=zoomOffsetTopVal-delta;if(zoomOffsetTopVal<0){zoomOffsetTopVal=zoomOffsetTopVal/2}}zoomToOffset=true;Q();return false};var Z=function(BU){if(!BU){BU=window.event}AQ();var BV=document.getElementById("vvRubberbandCanvas");if(A3(BU.clientX,BU.clientY,BV)===true){var BT=document.getElementById("innerDiv");pos=BI(BT);dragStartLeft=BU.clientX-pos[0];dragStartTop=BU.clientY-pos[1];var BS=new Point(dragStartLeft,dragStartTop);pointArray[Y]=BS;if(Y>1){if((dragStartLeft>(pointArray[0].getX()-(vvConfig.polygonNubSize/2)))&&(dragStartLeft<(pointArray[0].getX()+(vvConfig.polygonNubSize/2)))&&(dragStartTop>(pointArray[0].getY()-(vvConfig.polygonNubSize/2)))&&(dragStartTop<(pointArray[0].getY()+(vvConfig.polygonNubSize/2)))){d(BU);return false}}Y+=1;E=stripPx(BT.style.top);R=stripPx(BT.style.left);dragging=true}return false};var BP=function(BS){if(!BS){BS=window.event}if(dragging===true){var BT=document.getElementById("vvRubberbandCanvas");if(A3(BS.clientX,BS.clientY,BT)===true){a(BS)}}return false};var AC=function(BW){var BX=document.getElementById("vvAnnotationCanvas");var Bf=vvConfig.annotationDefaults.lineColor;var BV=null;width=dragStopLeft-dragStartLeft;height=dragStopTop-dragStartTop;var Bb=new BoundingBox(dragStartLeft,dragStartTop,width,height);var Be=Az;if((BW!==true)&&((Az===vvDefines.annotationTypes.SANN_EDIT)||(Az===vvDefines.annotationTypes.SANN_BUBBLE)||(Az===vvDefines.annotationTypes.SANN_CLOUD_EDIT)||(Az===vvDefines.annotationTypes.SANN_POSTIT))){Be=vvDefines.annotationTypes.SANN_RECTANGLE}if((Az===vvDefines.annotationTypes.SANN_FILLED_RECT)||(Az===vvDefines.annotationTypes.SANN_HIGHLIGHT_RECT)||(Az===vvDefines.annotationTypes.SANN_FILLED_ELLIPSE)||(Az===vvDefines.annotationTypes.SANN_FILLED_POLYGON)||(Az===vvDefines.annotationTypes.SANN_CIRCLE)){Bf=null;BV=vvConfig.annotationDefaults.fillColor}var Bd=vvConfig.annotationDefaults.lineWidth;if(!BW&&((Az===vvDefines.annotationTypes.SANN_POSTIT)||(Az===vvDefines.annotationTypes.SANN_EDIT))){Bd=1}var Ba=myPainter.getCurrentLayer();var BU=Av.getStateForDocumentId(Av.getDocumentId());var BY=BU.getDPIForPage(BU.getPageNumber());if(Ba.isIDM){BY=200}var BT=new PreviewAnnotation(Be,Bb,Bf,BV,Bd,vvConfig.annotationDefaults.highlightOpacity,pointArray,Ba.doubleByte,BY,Ba.isIDM);if(BW===true){var Bc=BT.getFontSize();var BZ=BT.getLineWidth();BT.setPageWidth(Ba.pageWidth);BT.setPageHeight(Ba.pageHeight);BT.setFontSize(Bc);BT.setLineWidth(BZ)}if(Ba.isFilenet){BT.isFilenet=true}if(Ba.isDaeja){BT.isDaeja=true}if(Ba.isIDM){BT.isIDM=true;if(BT.getType()===vvDefines.annotationTypes.SANN_POSTIT){BT.setFontSize(200,true)}else{if(BT.getType()===vvDefines.annotationTypes.SANN_EDIT){}}}if((Av.currentStamp!==undefined)&&(Av.currentStamp!==null)&&(Av.currentStamp>-1)){var BS=vvConfig.rubberStamp[Av.currentStamp];if(BW){Av.currentStamp=null}if(BS.textString){BT.setTextString(BS.textString)}if(BS.fontFace){BT.setFontName(BS.fontFace)}if(BS.fontSize){BT.setFontSize(BS.fontSize)}if(BS.fontBold){BT.fontBold=BS.fontBold}if(BS.fontItalic){BT.fontItalic=BS.fontItalic}if(BS.fontStrike){BT.fontStrike=BS.fontStrike}if(BS.fontUnderline){BT.fontUnderline=BS.fontUnderline}if(BS.fontColor){BT.fontColor=BS.fontColor}}return BT};var A3=function(BS,BV,BT){var BU=BI(BT);if((BS>=BU[0])&&(BV>=BU[1])){if((BS<(BU[0]+BT.width))&&(BV<(BU[1]+BT.height))){return true}}else{return false}};var AF=function(BS){if(dragStopLeft>BS.width){dragStopLeft=BS.width}else{if(dragStopLeft<0){dragStopLeft=0}}if(dragStopTop>BS.height){dragStopTop=BS.height}else{if(dragStopTop<0){dragStopTop=0}}};var J=function(BV){var BT=document.getElementById("outerDiv");var BU=document.getElementById("innerDiv");dragging=false;if(BV===vvDefines.dragModes.pan){BT.onmousedown=w;BT.onmousemove=Au;BT.onmouseup=H;BT.onclick=null}else{if(BV===vvDefines.dragModes.annotate){var BS=Az.indexOf("Polygon");if(BS===-1){BT.onmousedown=c;BT.onmousemove=a;BT.onmouseup=d;BT.onclick=null}else{BT.onmousedown=null;BT.onmousemove=null;BT.onmouseup=null;BT.onclick=Z;BT.onmousemove=BP}}else{if(BV===vvDefines.dragModes.moveAnnotation){BT.onmousedown=BG;BT.onmousemove=L;BT.onmouseup=BD;BT.onclick=null}else{if(BV===vvDefines.dragModes.zoom){BT.onmousedown=c;BT.onmousemove=Al;BT.onmouseup=Ab;BT.onclick=null}else{if(BV===vvDefines.dragModes.textAnnotationEdit){BT.onmousedown=null;BT.onmousemove=null;BT.onmouseup=null;BT.onclick=function(BW){$(".vvTextAnnEditTextArea").focus()}}}}}}};function BI(BU){var BV=0;var BT=0;if(BU.offsetParent){do{BV+=BU.offsetLeft;BT+=BU.offsetTop}while((BU=BU.offsetParent))}if(vvConfig.imageScrollBars===true){var BS=document.getElementById("outerDiv");BT=BT-BS.scrollTop;BV=BV-BS.scrollLeft}return[BV,BT]}var C=function(BV,BU,BS){var BT=document.getElementById("outerDiv");var BX=vvConfig.servletPath+"?action="+BU;var BW=AJ(Aj,BV);if(BS===true){BX+="&documentId="+encodeURIComponent(BW);BX+="&clientInstanceId="+encodeURIComponent(myFlexSnap.getClientInstanceId())}else{BX+="&documentId="+BW;BX+="&clientInstanceId="+myFlexSnap.getClientInstanceId()}BX+="&zoomPercent="+Math.round(Av.zoomPercent);BX+="&pageNumber="+At(Aj);BX+="&flipHorizontal="+AP;BX+="&flipVertical="+AE;BX+="&invertImage="+Aa;BX+="&requestedHeight="+Ai;BX+="&requestedWidth="+Am;BX+="&clientWidth="+BT.clientWidth;BX+="&clientHeight="+BT.clientHeight;BX+="&pageCount="+j;if(vvDefines.cacheBuster===true){BX+="&cacheBuster="+Math.random()}return BX};var A7=function(BS){newURL=C(BS,"getTiledImage",false);newURL+="&tilePixelSize="+vvDefines.tilePixelSize;newURL+="&tileScaleFactor="+vvDefines.tileScaleFactor;ajax(newURL,"",D)};var O=function(BS){if(!BS||!BS.getDocumentId()){return null}var BT=AJ(Aj,BS);if((BS.getOriginalWidthForPage(Aj)===0)||!BS.getDisplayName()){var BU=vvConfig.servletPath;BU+="?action=getImageInfo";BU+="&documentId="+BT;BU+="&clientInstanceId="+myFlexSnap.getClientInstanceId();BU+="&pageNumber="+At(Aj);BU+="&pageCount="+BS.getPageCount();if(vvDefines.cacheBuster===true){BU+="&cacheBuster="+Math.random()}$.ajax({url:BU,dataType:"json",success:function(BV){s(BV,BS)},error:function(BV){console.log("error")}})}else{s(null,BS)}};var Ao=function(BU){var BV=C(BU,"getImage",false);var BT=null;if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<9)){BT=C(BU,"getImage",true)}var BS=new Image();o();BS.onload=function(){BU.setImageObject(BS);if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version===9)){r=setTimeout(function(BW){Ad(BS,BU)},vvDefines.ie9DrawDelay)}else{Ad(BS,BU)}A9(false)};BS.doubleSrc=BT;BS.src=BV};var Ad=function(BT,BV){var BU=document.getElementById("vvImageCanvas");var BS=BU.getContext("2d");$(".vvCanvas").each(function(){this.width=Am;this.height=Ai;if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<9)){$(this).children().width(Am);$(this).children().height(Ai)}});o();myFlexSnap.requestAnnotations(BV);BS.save();BS.rotate(degreesToRadians(rotateAngle));switch(rotateAngle){case 0:BS.drawImage(BT,0,0,Am,Ai);break;case 90:BS.drawImage(BT,0,-Am,Ai,Am);break;case 180:BS.drawImage(BT,-Am,-Ai,Am,Ai);break;case 270:BS.drawImage(BT,-Ai,0,Ai,Am);break}BS.restore();Av.paintSearchResults()};var g=function(){var BS=Av.getStateForDocumentId(Av.getDocumentId());O(BS)};var AY=function(BW){var BX=vvConfig.servletPath+"?action=exportDocument";BX+="&documentId="+Av.getDocumentId();BX+="&clientInstanceId="+myFlexSnap.getClientInstanceId();BX+="&saveFormat="+BW;BX+="&pageCount="+j;if(vvDefines.cacheBuster===true){BX+="&cacheBuster="+Math.random()}if(vvConfig.exportBurnAnnotations===true){var BT=myFlexSnap.getDocumentModel();if(BT){var BV=BT.model.layerManager.layers.length;for(var BU=0;BU<BV;BU++){var BS=unescape(BT.model.layerManager.layers[BU].annotationId);BX+="&burnLayer="+BS}}}window.location=BX};var AL=function(BS){if(!BS){BS=window.event}};var A0=function(){var BW=document.getElementById("outerDiv");var BU=document.getElementById("innerDiv");var BX=myFlexSnap.getOriginalHeight();var BY=myFlexSnap.getOriginalWidth();if((rotateAngle===90)||(rotateAngle===270)){BX=myFlexSnap.getOriginalWidth();BY=myFlexSnap.getOriginalHeight()}var BV=BY;var BS=BX;widthRatio=BW.clientWidth/BY;heightRatio=BW.clientHeight/BX;zoomRatio=Av.zoomPercent/100;var BT=false;if(Av.zoomMode===vvDefines.zoomModes.fitLast){BT=true}if(Av.zoomMode===vvDefines.zoomModes.fitHeight||Av.zoomMode===vvDefines.zoomModes.fitWidth||Av.zoomMode===vvDefines.zoomModes.fitWindow||BT){if(BY&&BX){if(Av.zoomMode===vvDefines.zoomModes.fitWindow||BT){if(widthRatio>=heightRatio){Av.zoomMode=vvDefines.zoomModes.fitHeight}else{Av.zoomMode=vvDefines.zoomModes.fitWidth}}}if(Av.zoomMode===vvDefines.zoomModes.fitWidth){BV=BY*widthRatio;BS=BX*widthRatio;zoomRatio=((BV/BY))}if(Av.zoomMode===vvDefines.zoomModes.fitHeight){BV=BY*heightRatio;BS=BX*heightRatio;zoomRatio=((BS/BX))}Av.zoomPercent=zoomRatio*100}else{if(zoomRatio!==1){BV=BV*zoomRatio;BS=BS*zoomRatio}}Am=Math.round(BV);Ai=Math.round(BS)};var A2=function(Bd,BU){var BV=AN(Bd,BU);var BW=document.getElementById("innerDiv");var BY={};var Bc=vvConfig.servletPath+"?action=getTile&documentId="+Av.getDocumentId()+"&clientInstanceId="+myFlexSnap.getClientInstanceId();if(vvDefines.cacheBuster===true){Bc+="&cacheBuster="+Math.random()}for(i=0;i<BV.length;i++){var BX=BV[i];var BS="x"+BX[0]+"y"+BX[1]+"z"+Av.zoomPercent+"r"+rotateAngle;BY[BS]=true;var BZ=document.getElementById(BS);if(!BZ){var Bb=Bc+"&xpos="+BX[0]+"&ypos="+BX[1]+"&zoom="+Av.zoomPercent+"&rotate="+rotateAngle;BZ=document.createElement("img");BZ.src=Bb;BZ.style.position="absolute";BZ.style.left=(BX[0]*vvDefines.tilePixelSize)+"px";BZ.style.top=(BX[1]*vvDefines.tilePixelSize)+"px";BZ.style.visibility="visible";BZ.setAttribute("id",BS);BW.appendChild(BZ)}}var Ba=BW.getElementsByTagName("img");for(i=0;i<Ba.length;i++){var BT=Ba[i].getAttribute("id");if(!BY[BT]){BW.removeChild(Ba[i]);i--}}};var BH=function(BS){var BT=document.getElementById("innerDiv");var BU=BT.getElementsByTagName("img");for(i=0;i<BU.length;i++){BU[i].style.visibility=BS}};var o=function(){var BW=Av.getStateForDocumentId(Av.getDocumentId());if(BW){var BU=document.getElementById("innerDiv");var BV=document.getElementById("outerDiv");var BX=$("#vvImageCanvas")[0];var BT=0;var BS=0;if(BX.width<BV.clientWidth){BT=(BV.clientWidth/2)-(BX.width/2)}if(BX.height<BV.clientHeight){BS=(BV.clientHeight/2)-(BX.height/2)}if(zoomToOffset){if(vvConfig.imageScrollBars===true){BV.scrollTop=zoomOffsetTopVal;BV.scrollLeft=zoomOffsetLeftVal}else{BS=zoomOffsetTopVal*-1;BT=zoomOffsetLeftVal*-1}zoomToOffset=false}BU.style.top=BS+"px";BU.style.left=BT+"px";BU.style.height=BX.height+"px";BU.style.width=BX.width+"px"}};var X=function(){o();$("#vvRubberbandCanvas").bind("contextmenu",Av.annPopUpHandler)};FlexSnapAjax.prototype.annPopUpHandler=function(BX){BX.preventDefault();var Bb=BX.clientX;var BZ=BX.clientY;var Ba=BI(document.getElementById("innerDiv"));var Bc=new Point(BX.clientX-Ba[0],BX.clientY-Ba[1]);var BS=myPainter.getAnnotationAtPoint(Bc);var BW=null;if(!BS){$("#vvAnnPopUp").hide()}else{Av.setCurrentAnnObject(BS);$("#vvAnnLineColorLabel").hide();$("#vvAnnBorderColorLabel").hide();$("#vvAnnFillColorLabel").hide();$("#vvAnnTextColorLabel").hide();if(BS.getFontColor()){$("#vvAnnTextColorLabel").show();Av.vvAnnThicknessObject=$("#vvAnnThickness").detach();$("#vvAnnText").show();$("#vvAnnTextEditButton").show();BW=BS.getFontColor()}else{if(BS.getFillColor()){$("#vvAnnFillColorLabel").show();if(!Av.vvAnnThicknessObject){Av.vvAnnThicknessObject=$("#vvAnnThickness").detach()}$("#vvAnnText").hide();$("#vvAnnTextEditButton").hide();BW=BS.getFillColorRGB()}else{if(BS.getLineColor()){$("#vvAnnLineColorLabel").show();if(Av.vvAnnThicknessObject){Av.vvAnnThicknessObject.insertAfter("#vvAnnColor");Av.vvAnnThicknessObject=null}$("#vvAnnText").hide();$("#vvAnnTextEditButton").hide();BW=BS.getLineColorRGB()}}}if(BS.getFontName()){$("#vvAnnTextFaceSelect").val(toTitleCase(BS.getFontName()))}if(BS.getFontSize()){$("#vvAnnTextSizeSelect").val(BS.getFontSize())}if(BS.getFontBold()===true){$("#vvAnnTextStyleBold").attr("checked","checked")}else{$("#vvAnnTextStyleBold").attr("checked",null)}if(BS.getFontItalic()===true){$("#vvAnnTextStyleItalic").attr("checked","checked")}else{$("#vvAnnTextStyleItalic").attr("checked",null)}if(BS.getFontUnderline()===true){$("#vvAnnTextStyleUnderline").attr("checked","checked")}else{$("#vvAnnTextStyleUnderline").attr("checked",null)}var BU=false;for(var BY=0;BY<vvDefines.annColors.length;BY+=1){var BV=vvDefines.annColors[BY];if(BV.toLowerCase()===BW.toLowerCase()){BU=true;cName="vvAnnColorGrid";BK(cName,$("#"+cName+BY)[0],BY)}}$("#vvAnnColorCustomInput").attr("value",BW);var Bd=$("#outerDiv").width();var BT=$("#outerDiv").height();if((Bb+$("#vvAnnPopUp").width())>Bd){Bb=Bd-$("#vvAnnPopUp").width()}if((BZ+$("#vvAnnPopUp").height())>BT){BZ=BT-$("#vvAnnPopUp").height()}$("#vvAnnPopUp").css("top",BZ);$("#vvAnnPopUp").css("left",Bb);$("#vvAnnPopUp").show()}return false};var AG=function(BT){var BW=this;var BU=BW.src;var BZ=parseInt(AA(BU,"virtualPageNumber"),10);var BX=AA(BU,"documentListThumb");var BV=AA(BU,"searchThumb");var BY="#vvPageThumbs ";if(BX==="true"){BY="#vvDocThumbs "}else{if(BV==="true"){BY="#vvSearch "}}var Bf=$(BY+"tr");var Bd=$(BY+"td");var Be=Bf[BZ];var Ba=Bd[BZ];var Bc=$(Ba).children("div");var BS=$(Bc).children("img");if(!BS){return(false)}else{BS.addClass("displayedThumb");BS.css("visibility","visible")}var Bb=0;if(BW.height>0){Bb=BW.height}else{if(BS.height>0){Bb=BS.css("height")}}if(Bb>0){BS.css("position","relative")}BE()};var T=function(BW){if(!BW){BW=window.event}var BT=null;if((BrowserDetect.browser==="Explorer")&&(BrowserDetect.version<=9)){BT=$(BW.srcElement);BW.srcElement.src="resources/pageNotFound.png"}else{BT=$(BW.target);BW.target.src="resources/pageNotFound.png"}BT.css("visibility","");BT.addClass("displayedThumb");var BS=BT.css("width");var BU=BT.css("height");var BV=vvDefines.thumbnailSize;if(BS>BU){BT.css("height",(BU/(BS/BV))+"px");BT.css("width",BV+"px")}else{BT.css("width",(BS/(BU/BV))+"px");BT.css("height",BV+"px")}};FlexSnapAjax.prototype.thumbTest=function(BU,BT,BS){A8(BU,BT,BS);Av.loadVisibleThumbs(null,BU,BT,BS)};var BF=function(BY,BX,BT,BW,BS){if(BX){BX.detach();var BV=document.createElement("tbody");BV.id=BX[0].id+"Body";for(var BU=0;BU<BT;BU+=1){var Ba=document.createElement("tr");var BZ=document.createElement("td");$(Ba).addClass("thumbRowEmpty");$(BZ).addClass("thumbCell");$(Ba).hide();$(BZ).data("pageNumber",BU);if(BW!==true){if(vvConfig.pageManipulations===true&&BS!==true){$(Ba).contextMenu("vvThumbContextMenu",{bindings:{selectAll:function(Bb){Av.getDocumentModel().selectAll()},selectNone:function(Bb){Av.getDocumentModel().clearPageSelection()},"delete":function(Bb){Av.cutSelection(true)},cut:function(Bb){Av.cutSelection(false)},copy:function(Bb){Av.copySelection()},insertBefore:function(Bb){Av.pasteSelection(Bb.rowIndex)},insertAfter:function(Bb){Av.pasteSelection(Bb.rowIndex+1)},newDocument:function(Bb){if(e){Av.createNewDocument(e())}else{$("#vvNewDocumentDialog").dialog("open")}}},onShowMenu:function(Bc,Bd){var Bb=myFlexSnap.getDocumentModel();var Be=$(Bc.target).closest("tr").index();if((Bc.ctrlKey===true)||(Bc.metaKey===true)){}else{if(Bc.shiftKey===true){}else{if(Bb.isPageSelected(Be)!==true){Bb.clearPageSelection();Bb.addPageToSelection(Be)}}}if(!AS||!AS.model||(AS.model.length===0)){$("#insertBefore",Bd).remove();$("#insertAfter",Bd).remove()}if(Bb.getSelectedPageNumbers().length===0){$("#cut",Bd).remove();$("#copy",Bd).remove();$("#newDocument",Bd).remove()}if(vvConfig.pageManipulationsNewDocumentMenu!==true){$("#newDocument",Bd).remove()}return Bd}})}}Ba.appendChild(BZ);BV.appendChild(Ba)}BX.append(BV);BX.appendTo(BY)}};var A8=function(BS,BX,BT,Bb,BW){var BZ,BY;if(BX){AI(BX,BT)}if(vvConfig.showThumbnailPanel===true){if(BX){BZ=$("#vvDocThumbs");BY=$("#vvDocThumbsInternal");thumbCount=Av.documentList.length}else{if(BT){BZ=$("#vvSearchResults");BY=$("#vvSearchInternal");thumbCount=BS.getPageCount()}else{BZ=$("#vvPageThumbs");BY=$("#vvPageThumbsInternal");thumbCount=BS.getPageCount()}}if(!Bb){Bb=0}if(!BW){BW=thumbCount}if(BY.find("tr").length===0){BF(BZ,BY,thumbCount,BX,BT)}if(BY){var BV=$("#"+BY[0].id+"Body");for(var BU=Bb;BU<BW;BU+=1){var Bc=BV.find("tr")[BU];if(BT){if(!BS.getSearchResultsForPage(BU)){continue}}$(Bc).removeClass("thumbRowEmpty");$(Bc).show();thumb=N(BU,BX);$(thumb).click(function(Be){var Bf=$(this).closest("td").data("pageNumber");if(BX===true){Av.openInTab(Av.documentList[Bf])}else{var Bd=Av.getDocumentModel();if((Be.ctrlKey===true)||(Be.metaKey===true)){if(vvConfig.pageManipulations===true){Bd.togglePageSelection(Bf)}}else{if(Be.shiftKey===true){if(vvConfig.pageManipulations===true){Bd.selectRange(Bf)}}else{if(vvConfig.pageManipulations===true){Bd.clearPageSelection();Bd.addPageToSelection(Bf)}Av.currentMatch=0;Av.setPage(Bf)}}}});var Ba=BV.find("td")[BU];Ba.appendChild(thumb)}$(BY).click(function(Be){var Bd=Av.getDocumentModel();var Bf=$(Be.target).closest("div");if((Bf.length>0)&&(Bf.hasClass("thumbBox")!==true)&&(Bf.hasClass("selectedThumbBox")!==true)&&(Bf.hasClass("activeThumbBox")!==true)){if(Bd){Bd.clearPageSelection()}}});BE();AV()}}};var N=function(BV,BU){var BT=document.createElement("div");var BS=document.createElement("img");BT.className="thumbBox";if(BU===true){BT.title=Av.documentList[BV]}else{BT.title="Page "+(BV+1)}BS.src=BQ;BS.className="displayedThumb";BT.appendChild(BS);$(BT).tooltip();return BT};var u=function(BS){var BT=Av.getStateForDocumentId(Av.getDocumentId());if(!BS){BS=window.event}if(r){clearTimeout(r)}if($("#vvThumbs").tabs("option","selected")===0){r=setTimeout(function(BU){Av.loadVisibleThumbs(BU,BT,false,false)},200)}else{if($("#vvThumbs").tabs("option","selected")===1){r=setTimeout(function(BU){Av.loadVisibleThumbs(BU,BT,true,false)},200)}else{r=setTimeout(function(BU){Av.loadVisibleThumbs(BU,BT,false,true)},200)}}};FlexSnapAjax.prototype.processWindowResize=function(BS){var BT=Av.getStateForDocumentId(Av.getDocumentId());if(!BS){BS=window.event}if(BrowserDetect.OS.indexOf("iPhone/iPod")>-1){return }Av.loadVisibleThumbs(null,BT,false);g()};FlexSnapAjax.prototype.getDocumentId=function(){return M};FlexSnapAjax.prototype.setDocumentId=function(BS){M=BS};FlexSnapAjax.prototype.getOpenDocuments=function(){return this.openDocuments};FlexSnapAjax.prototype.getStateForDocumentId=function(BS){return this.openDocuments[BS]};FlexSnapAjax.prototype.setStateForDocumentId=function(BT,BS){if(BS){this.openDocuments[BT]=BS}else{delete this.openDocuments[BT]}};FlexSnapAjax.prototype.loadVisibleThumbs=function(Bi,BW,Be,BY){if(!Bi){Bi=window.event}if(BrowserDetect.OS.indexOf("iPhone/iPod")>-1){if(window.orientation===0){return }}var Bc=document.getElementById("vvPageThumbs");var Bh="#vvPageThumbs ";if(Be===true){Bc=document.getElementById("vvDocThumbs");Bh="#vvDocThumbs "}else{if(BY===true){Bc=document.getElementById("vvSearchResults");Bh="#vvSearchResults "}}if(Bc){var BT=Bc.scrollTop;var Bd=BT+$(Bh)[0].clientHeight;var Bg=0;var BZ=$(Bh+"tr");var BU=$(Bh+"td");var BV=0;if(BZ.length>0){BV=BZ.filter(":not('.thumbRowEmpty')").eq(0).height()}else{return }Bg=parseInt(BT/BV,10)-2;if(Bg<0){Bg=0}var Bo=BU.length;if(Be===true){Bo=Av.documentList.length}for(var Bj=Bg;Bj<Bo;Bj+=1){var BX=BZ[Bj];var BS=BU[Bj];var Bf=$(BS).children("div");var Bl=$(Bf).children("img");var Bk=BS.offsetTop;var Bb=Bk+BS.clientHeight;if((Bk<Bd)&&(Bb>BT)){if(Bl.attr("src").indexOf(BQ)>-1){var Bm=document.createElement("img");var Bn="";if(BY===true){var Ba=Bf.closest("td").data("pageNumber");Bn=vvConfig.servletPath+"?action=getThumbnail&documentId="+AJ(Ba,BW);Bn+="&pageNumber="+At(Ba);Bn+="&searchThumb=true"}else{if(Be===false){Bn=vvConfig.servletPath+"?action=getThumbnail&documentId="+AJ(Bj,BW);Bn+="&pageNumber="+At(Bj)}else{Bn=vvConfig.servletPath+"?action=getThumbnail&documentId="+Av.documentList[Bj];Bn+="&documentListThumb=true";Bn+="&pageNumber=0"}}Bn+="&thumbnailSize="+vvDefines.thumbnailSize;Bn+="&clientInstanceId="+this.getClientInstanceId();Bn+="&virtualPageNumber="+Bj;if(BW){Bn+="&pageCount="+BW.getPageCount()}if((vvDefines.cacheBuster===true)||(BrowserDetect.browser==="Explorer")){Bn+="&cacheBuster="+Math.random()}Bm.src=Bn;Bm.onload=AG;Bm.onerror=T;Bm.style.visibility="hidden";$(Bl).replaceWith(Bm)}}else{if(Bk>Bd){break}}}}};var AJ=function(BU,BT){var BV=BT.getDocumentId();var BS=BT.getDocumentModel();if(!BT.getDocumentId()){return null}if(BS){BV=BS.model.pageData[BU].documentId}return BV};var At=function(BU){var BS=BU;var BT=myFlexSnap.getDocumentModel();if(!Av.getDocumentId()){return null}if(BT){BS=BT.model.pageData[BU].pageIndex}return BS};var q=function(){var BT=document.getElementById("vvPageThumbs");var BV=BT.getElementsByTagName("td");if(BV.length>0){if(isNaN(Aj)){Aj=0}var BS=BV[Aj];var BY=BT.scrollTop;var BX=BY+BT.clientHeight;var BU=BS.offsetTop;var BW=BU+BS.clientHeight;if((BW>BX)||(BU<BY)){BT.scrollTop=BU}}};var BN=function(){var BZ=document.getElementById("vvDocThumbs");var BT=0;for(var BS=0;BS<Av.documentList.length;BS+=1){if(Av.documentList[BS]===Av.getDocumentId()){BT=BS;break}}var BV=document.getElementById("thumbBox"+BT);if(!BV){return }var BY=BZ.scrollTop;var BX=BY+BZ.clientHeight;var BU=BV.offsetTop;var BW=BU+BV.clientHeight;if((BW>BX)||(BU<BY)){BZ.scrollTop=BU}};var Ap=function(){var BU=document.getElementById("vvSearchResults");var BV=BU.getElementsByTagName("td");if(BV.length>0){var BS=BV[Aj];var BY=BU.scrollTop;var BX=BY+BU.clientHeight;var BT=BS.offsetTop;var BW=BT+BS.clientHeight;if((BW>BX)||(BT<BY)){BU.scrollTop=BT}}};var BE=function(){$(".activeThumbBox").removeClass("activeThumbBox");$(".activeThumb").removeClass("activeThumb");var BU=$("#vvPageThumbs td div:eq("+Aj+")");BU.addClass("activeThumbBox");BU.find("img").addClass("activeThumb");var BT=0;for(var BS=0;BS<Av.documentList.length;BS+=1){if(Av.documentList[BS]===Av.getDocumentId()){BT=BS;break}}var BV=$("#vvDocThumbs td div:eq("+BT+")");BV.addClass("activeThumbBox");BV.find("img").addClass("activeThumb");var BW=$("#vvSearch td").eq(Aj).find("div");BW.addClass("activeThumbBox");BW.find("img").addClass("activeThumb")};FlexSnapAjax.prototype.exportDocument=function(){$("#vvExportDialog").dialog("open")};FlexSnapAjax.prototype.saveDocument=function(BV){var BU=true;$("#vvSaveDocumentDialog").dialog("open");var BX=vvConfig.servletPath+"?action=saveDocumentModel&documentId="+Av.getDocumentId();BX+="&clientInstanceId="+this.getClientInstanceId();BX+="&cacheBuster="+Math.random();var BS=this.getDocumentModel();var BT="modelJSON="+encodeURIComponent(JSON.stringify(BS.model));if(BV){BU=false}if(BS.getPagesModifiedSinceInit()===true){$.ajax({type:"POST",url:BX,dataType:"json",data:BT,async:BU,success:function(Be){var Bd=null;if(BJ(Be)===true){$("#vvSaveDocumentDialog").dialog("close");return }if(BL){BL(Av.getDocumentId(),Av.getClientInstanceId(),Be.documentIdToReload)}if(vvConfig.reloadDocumentOnSave===true){var Bc=encodeURIComponent(Be.documentIdToReload);var BY=Av.getDocumentId();if(!Bc||(Bc==="undefined")){Bc=BY}Av.setDocumentId(Bc);Bd=Av.getStateForDocumentId(BY);Bd.documentId=Bc;Av.setStateForDocumentId(BY,undefined);Av.setStateForDocumentId(Bc,Bd);Av.removeFromRecentlyViewed(BY);Av.addToRecentlyViewed(Bc);for(var Bb=0;Bb<Av.tabs.length;Bb+=1){if(Av.tabs[Bb]===BY){Av.tabs[Bb]=Bc;break}}Av.getDocumentModel().cleanAfterSave(Bc);Av.requestDocumentList();A8(Bd,true);Av.loadVisibleThumbs(null,Bd,true)}else{Bd=Av.getStateForDocumentId(Av.getDocumentId());Av.getDocumentModel().cleanAfterSave(Av.getDocumentId())}if((rotateAngle===90)||(rotateAngle===270)){var BZ=Bd.getOriginalWidthForPage(Aj);var Ba=Bd.getOriginalHeightForPage(Aj);Bd.setOriginalWidthForPage(Aj,Ba);Bd.setOriginalHeightForPage(Aj,BZ);K=Ba;AZ=BZ}rotateAngle=0;Bd.resetAfterSave();Bd.saveAnnotationLayers(true)},error:function(BY){console.log("error")}})}else{var BW=myFlexSnap.getStateForDocumentId(Av.getDocumentId());BW.saveAnnotationLayers()}};FlexSnapAjax.prototype.rotateClock=function(){var BS=myFlexSnap.getStateForDocumentId(Av.getDocumentId());rotateAngle+=90;if(rotateAngle>=360){rotateAngle=0}BS.setRotationForPage(Aj,rotateAngle);BS.rotateLayersForPage(Aj,90);A0();Q()};FlexSnapAjax.prototype.rotateCounter=function(){var BS=myFlexSnap.getStateForDocumentId(Av.getDocumentId());rotateAngle-=90;if(rotateAngle<0){rotateAngle+=360}BS.setRotationForPage(Aj,rotateAngle);BS.rotateLayersForPage(Aj,-90);A0();Q()};FlexSnapAjax.prototype.zoomIn=function(){Av.zoomPercent+=25;if(Av.zoomPercent>vvConfig.maxZoomPercent){Av.zoomPercent=vvConfig.maxZoomPercent}Av.zoomMode=vvDefines.zoomModes.fitCustom;A0();if(Av.zoomPercent>=vvDefines.tileZoomThreshold){BH("visible");AD=true}Q()};FlexSnapAjax.prototype.zoomOut=function(){Av.zoomPercent-=25;Av.zoomMode=vvDefines.zoomModes.fitCustom;A0();if((Am<1)||(Ai<1)){alert("Cannot zoom out any further");Av.zoomPercent+=25;return }if(AD&&Av.zoomPercent<vvDefines.tileZoomThreshold){BH("hidden");AD=false}if(Av.zoomPercent<vvDefines.tileZoomThreshold){AD=false}Q()};var Q=function(){var BT=Av.getStateForDocumentId(Av.getDocumentId());var BS=BT.getImageObject();$("#vvAnnPopUp").hide();Av.setCurrentAnnObject(null);BT.setZoomForPage(Aj,Av.zoomPercent);BT.setZoomModeForPage(Aj,Av.zoomMode);if(BS){Ad(BS,BT);if(As){clearTimeout(As)}As=setTimeout(function(BU){g()},vvConfig.zoomTimeout)}else{g()}};FlexSnapAjax.prototype.flipX=function(){AP=!AP;g()};FlexSnapAjax.prototype.flipY=function(){AE=!AE;g()};FlexSnapAjax.prototype.invertImage=function(){var BS=myFlexSnap.getStateForDocumentId(Av.getDocumentId());Aa=!Aa;BS.setInvertImageForPage(Aj,Aa);g()};FlexSnapAjax.prototype.fitWidth=function(){Av.zoomMode=vvDefines.zoomModes.fitWidth;BH("hidden");A0();g()};FlexSnapAjax.prototype.fitHeight=function(){Av.zoomMode=vvDefines.zoomModes.fitHeight;BH("hidden");A0();g()};FlexSnapAjax.prototype.fitWindow=function(){Av.zoomMode=vvDefines.zoomModes.fitWindow;BH("hidden");A0();g()};FlexSnapAjax.prototype.getPageCount=function(){return j};FlexSnapAjax.prototype.firstPage=function(){Av.currentMatch=0;Av.setPage(0)};FlexSnapAjax.prototype.nextPage=function(){Av.currentMatch=0;Av.setPage(Aj+1)};FlexSnapAjax.prototype.previousPage=function(){Av.currentMatch=0;Av.setPage(Aj-1)};FlexSnapAjax.prototype.lastPage=function(){Av.currentMatch=0;Av.setPage(j-1)};FlexSnapAjax.prototype.setPage=function(BU){var BS=Aj;Av.showingPageErrorDialog=true;$("#vvAnnPopUp").hide();Av.setCurrentAnnObject(null);if((BU<0)||((j>0)&&(BU>=j))){alert("No such page.");AV();Av.showingPageErrorDialog=false;return }else{Av.setCurrentAnnObject(null);myPainter.clearAnnotations();AB();Aj=BU;if(AD&&vvDefines.tilesEnabled){BH("hidden");AD=false}}if(BS>=j){A6()}else{A6(BS)}var BT=Av.getStateForDocumentId(Av.getDocumentId());BT.setPageNumber(BU);BE();q();Ap();A9(true);O(BT);AV();AU();b();Av.showingPageErrorDialog=false};var A9=function(BS){if(waitDialogTimeoutId){clearTimeout(waitDialogTimeoutId)}if(BS){waitDialogTimeoutId=setTimeout(function(){$("#vvWaitIndicator").dialog("open")},vvConfig.waitDialogTimeout)}else{$("#vvWaitIndicator").dialog("close")}};FlexSnapAjax.prototype.printDocument=function(){$("#vvPrintFirstPage").val(1);$("#vvPrintLastPage").val(j);if(Av.getDocumentId().indexOf("VirtualDocument")===0){$("#vvPrintAnnotationsSelected").removeAttr("checked");$("#vvPrintAnnotationsSelected").attr("disabled","disabled");$("#vvPrintOptionsAnnotationsCheckbox").addClass("vvPrintAnnotationsDisabled")}else{$("#vvPrintAnnotationsSelected").removeAttr("disabled");$("#vvPrintOptionsAnnotationsCheckbox").removeClass("vvPrintAnnotationsDisabled");$("#vvPrintAnnotationsSelected").attr("checked",vvConfig.printBurnAnnotations);if(vvConfig.printBurnAnnotations){$("#vvPrintAnnotationsTypeCheckboxes").removeClass("vvPrintAnnotationsDisabled");$("#vvPrintAnnotationsTypeText").removeAttr("disabled");$("#vvPrintAnnotationsTypeNonText").removeAttr("disabled")}else{$("#vvPrintAnnotationsTypeCheckboxes").addClass("vvPrintAnnotationsDisabled");$("#vvPrintAnnotationsTypeText").attr("disabled","disabled");$("#vvPrintAnnotationsTypeNonText").attr("disabled","disabled")}}$("#vvPrintDialog").dialog("open")};FlexSnapAjax.prototype.printDocumentCore=function(Be){var BY=parseInt($("#vvPrintFirstPage").val(),10)-1;var Bb=parseInt($("#vvPrintLastPage").val(),10)-1;var Bh=true;if($("#vvPrintColorSelected:checked").val()){Bh=false}var BZ="";if((BY<0)||(Bb>(j-1))){alert("Page range out of bounds");return }for(var Bf=BY;Bf<Bb+1;Bf+=1){var Bg=vvConfig.servletPath;var BT=Av.getStateForDocumentId(Av.getDocumentId());Bg+="?action=getImage&documentId="+AJ(Bf,BT);Bg+="&clientInstanceId="+myFlexSnap.getClientInstanceId();Bg+="&pageNumber="+At(Bf);Bg+="&printSession=true";Bg+="&grayScale="+Bh;Bg+="&rotateAngle="+BT.getRotationForPage(Bf);Bg+="&invertImage="+BT.getInvertImageForPage(Bf);if(vvDefines.cacheBuster===true){Bg+="&cacheBuster="+Math.random()}if(vvConfig.printBurnAnnotations===true){var Ba=myFlexSnap.getDocumentModel();if(Ba){var BX=Ba.model.layerManager.layers.length;for(var BW=0;BW<BX;BW++){var Bc=unescape(Ba.model.layerManager.layers[BW].annotationId);var BV=Ba.model.pageData[Bf].annotationHash;var Bi=false;if(BV){var BU=BV[Bc];if(BU){Bi=BU.annExists}}if(Bi){Bg+="&burnLayer="+Bc}}}if(vvConfig.printShowTypeToggles){var Bd=vvDefines.annotationTypes;if($("#vvPrintAnnotationsTypeText").attr("checked")){Bg+="&burnType="+encodeURIComponent(Bd.SANN_POSTIT);Bg+="&burnType="+encodeURIComponent(Bd.SANN_EDIT);Bg+="&burnType="+encodeURIComponent(Bd.SANN_CLOUD_EDIT)}if($("#vvPrintAnnotationsTypeNonText").attr("checked")){Bg+="&burnType="+encodeURIComponent(Bd.SANN_FILLED_RECT);Bg+="&burnType="+encodeURIComponent(Bd.SANN_HIGHLIGHT_RECT);Bg+="&burnType="+encodeURIComponent(Bd.SANN_RECTANGLE);Bg+="&burnType="+encodeURIComponent(Bd.SANN_LINE);Bg+="&burnType="+encodeURIComponent(Bd.SANN_ELLIPSE);Bg+="&burnType="+encodeURIComponent(Bd.SANN_FILLED_ELLIPSE);Bg+="&burnType="+encodeURIComponent(Bd.SANN_FREEHAND);Bg+="&burnType="+encodeURIComponent(Bd.SANN_BITMAP);Bg+="&burnType="+encodeURIComponent(Bd.SANN_POLYGON);Bg+="&burnType="+encodeURIComponent(Bd.SANN_FILLED_POLYGON);Bg+="&burnType="+encodeURIComponent(Bd.SANN_ARROW);Bg+="&burnType="+encodeURIComponent(Bd.SANN_TRANSPARENT_BITMAP);Bg+="&burnType="+encodeURIComponent(Bd.SANN_BUBBLE);Bg+="&burnType="+encodeURIComponent(Bd.SANN_CUSTOM_STAMP);Bg+="&burnType="+encodeURIComponent(Bd.SANN_CIRCLE)}}}var BS="";BS+='<p class="breakhere"><img src="';BS+=Bg;BS+='" ';BS+=" /></p>";BZ+=BS}Be.jQuery("#printBody").html(BZ)};var G=function(BS){var BU=document.getElementById("vvRubberbandCanvas");var Bc=BU.getContext("2d");Bc.save();if(!BS||BS.getDelete()){return }var BV=BS.getBoundingBox();var BY=BS.getPointArray();var Bb=null;var BZ=null;if(BY){Bb=BY[0];BZ=BY[1]}if(((BS.getType()===vvDefines.annotationTypes.SANN_ARROW)||(BS.getType()===vvDefines.annotationTypes.SANN_LINE))&&(BY.length===2)){Bc.clearRect(0,0,BU.width,BU.height);AK(BS,Bb.getX()*BS.getWidthRatio(),Bb.getY()*BS.getHeightRatio());AK(BS,BZ.getX()*BS.getWidthRatio(),BZ.getY()*BS.getHeightRatio())}else{var BX=BV.getX1()*BS.getWidthRatio();var BW=BV.getY1()*BS.getHeightRatio();var BT=BV.getWidth()*BS.getWidthRatio();var Ba=BV.getHeight()*BS.getHeightRatio();Bc.lineWidth=1;Bc.strokeStyle="rgb(0,0,0)";Bc.clearRect(0,0,BU.width,BU.height);Bc.strokeRect(BX,BW,BT,Ba);AK(BS,BX,BW);AK(BS,BX+BT,BW);AK(BS,BX,BW+Ba);AK(BS,BX+BT,BW+Ba)}Bc.restore();J(vvDefines.dragModes.moveAnnotation)};var AK=function(BX,BS,BY){var BU=document.getElementById("vvRubberbandCanvas");var BT=BU.getContext("2d");var BW=BX.getBoundingBox();var BV=vvConfig.polygonNubSize/2;BT.fillStyle=vvConfig.polygonNubFillColor;BT.fillRect(BS-BV,BY-BV,vvConfig.polygonNubSize,vvConfig.polygonNubSize)};FlexSnapAjax.prototype.createColorGrid=function(BT,BY){var BU=document.createElement("div");BU.id=BT+"Chooser";var BS=0;var Ba=0;var BZ=null;for(var BX=0;BX<vvDefines.annColors.length;BX+=1){if(((Ba)%vvDefines.annColorRowSize)===0){Ba=0;BS+=1;BZ=document.createElement("div");BZ.id=BT+"ChooserRow"+BS;BU.appendChild(BZ);if(BS>1){$(BZ).addClass(BT+"SecondaryRow")}}var BW=document.createElement("div");BW.id=BT+BX;$(BW).addClass(BT+"ChooserCellUnselected");BW.style.backgroundColor="#"+vvDefines.annColors[BX];BW.style.width=vvDefines.annColorBlobSize+"px";BW.style.height=vvDefines.annColorBlobSize+"px";BW.style.left=((vvDefines.annColorBlobSize+5)*Ba++)+"px";BZ.appendChild(BW);var BV=function(){var Bb=BX;BW.onclick=function(){AX(BT,Bb)}};BV()}return BU};var BK=function(BU,BY,BT,BX){var BV=$("."+BU+"ChooserCellSelected");BV.addClass(BU+"ChooserCellUnselected");BV.removeClass(BU+"ChooserCellSelected");BV.css("width",vvDefines.annColorBlobSize+"px");BV.css("height",vvDefines.annColorBlobSize+"px");var BW=Av.getCurrentAnnObject();var BS=vvDefines.annColors[BT];if(BU&&BY){$(BY).addClass(BU+"ChooserCellSelected");BY.style.width=(vvDefines.annColorBlobSize-2)+"px";BY.style.height=(vvDefines.annColorBlobSize-2)+"px"}else{BS=BX}if(BW){if(BW.getFontColor()){BW.setFontColor(BS)}else{if(BW.getFillColor()){BW.setFillColor(BS)}else{if(BW.getLineColor()){BW.setLineColor(BS)}}}}};var AX=function(BT,BW){var BV=Av.getCurrentAnnObject();var BS=null;var BU=vvDefines.annotationTypes;if(BV.getFontColor()){BS=BV.getFontColor();BV.setFontColor(vvDefines.annColors[BW])}else{if(BV.getFillColor()){BS=BV.getFillColor();BV.setFillColor(vvDefines.annColors[BW])}else{if(BV.getLineColor()){BS=BV.getLineColor();BV.setLineColor(vvDefines.annColors[BW])}}}tempOption=document.getElementById(BT+BW);BK(BT,tempOption,BW);AQ();myPainter.markLayerWithAnnDirty(BV);myPainter.paintAnnotations()};var AQ=function(){var BU=document.getElementById("fillColorChooser");var BS=document.getElementById("lineColorChooser");var BT=document.getElementById("fontColorChooser");if(BU){BU.style.visibility="hidden"}if(BS){BS.style.visibility="hidden"}if(BT){BT.style.visibility="hidden"}};FlexSnapAjax.prototype.selectCurrentFontSize=function(BY){var BW=document.getElementById("annOptionsFontSizeMenu");var BT=document.getElementById("fontSizeSelect");var BU=document.getElementById("annOptionsFont");var BS=document.getElementById("annOptionsLine");var Ba=document.getElementById("annOptionsFill");if(!BY){setElementVisibility(BU,"collapse");BU.style.height="0"}else{setElementVisibility(BS,"collapse");setElementVisibility(Ba,"collapse");BU.style.height="1";tempOption=null;if(!BT){BT=document.createElement("select");BT.id="fontSizeSelect";for(var BX=0;BX<vvDefines.fontSizes.length;BX+=1){tempOption=document.createElement("option");var BZ=document.createTextNode(vvDefines.fontSizes[BX]);tempOption.id="fontSize"+BX;tempOption.value=vvDefines.fontSizes[BX];tempOption.appendChild(BZ);if(vvDefines.fontSizes[BX]===BY){tempOption.selected="selected"}BT.appendChild(tempOption)}BW.appendChild(BT)}else{for(var BV=0;BV<vvDefines.fontSizes.length;BV+=1){tempOption=document.getElementById("fontSize"+BV);if(vvDefines.fontSizes[BV]===BY){tempOption.selected="selected"}else{tempOption.selected=null}}}}};FlexSnapAjax.prototype.addAnnotation=function(BS){Az=BS;pointArray=[];Y=0;$("#vvAnnPopUp").hide();J(vvDefines.dragModes.annotate)};FlexSnapAjax.prototype.saveAnnotations=function(){var BS=myFlexSnap.getStateForDocumentId(Av.getDocumentId());if(BS){BS.setPageNumber(Aj)}BS.saveAnnotationLayers(true);BC()};FlexSnapAjax.prototype.toggleLayerManager=function(){var BS=$("#layerManagerDiv");if(!BS.data("vv-position-set")){BS.position({of:$("#layerMgr"),my:"left center",at:"right center"});BS.data("vv-position-set","true")}BS.toggle()};FlexSnapAjax.prototype.sendDocument=function(){var BS=vvConfig.servletPath+"?action=sendDocument&documentId="+Av.getDocumentId();BS+="&clientInstanceId="+this.getClientInstanceId();BS+="&withAnnotations="+vvConfig.sendDocumentWithAnnotations;BS+="&pageCount="+j;BS+="&stampStatus=";if(vvDefines.cacheBuster===true){BS+="&cacheBuster="+Math.random()}$.ajax({url:BS,dataType:"json",success:function(BT){if(BJ(BT)===true){return }},error:function(BT){if(BJ(BT)===true){return }}})};var AV=function(){$("#vvJumpToPageInput").val(Aj+1);if(j!==0){$("#vvJumpToPageTotal").html(j)}};var k=function(BX,BV,BT,BW,BS){var BU=document.getElementById(BX);if(BU){BU.style.opacity=BV;BU.style.visibility="visible";BU.style.filter="alpha(opacity="+(BV*100)+");";setTimeout(function(){I(BX,BT,BW,BS)},BW/(BT/BS))}};var I=function(BX,BU,BW,BS){var BV=document.getElementById(BX);var BT=parseFloat(BV.style.opacity);if(BS>0){if(BT<BU){BV.style.opacity=BT+BS;BV.style.filter="alpha(opacity="+((BT+BS)*100)+");";setTimeout(function(){I(BX,BU,BW,BS)},BW/(BU/BS))}}else{if(BT>BU){BV.style.opacity=BT+BS;BV.style.filter="alpha(opacity="+((BT+BS)*100)+");";setTimeout(function(){I(BX,BU,BW,BS)},BW/(BU/BS))}else{BV.style.visibility="hidden"}}};var A=function(BS){var BV;var BU;var BT;if(window.event){BV=BS.keyCode}else{if(BS.which){BV=BS.which}}BU=String.fromCharCode(BV);BT=/\r/;return BT.test(BU)};var f=function(BS){if((BS.length<6)||(BS.length>7)){return null}if(BS.charAt(0)==="#"){BS=BS.substr(1,BS.length)}if(BS.match(/^[0-9a-fA-F]+$/)){return BS}else{return null}};FlexSnapAjax.prototype.getPageNumber=function(){return Aj};FlexSnapAjax.prototype.getOriginalWidth=function(){return K};FlexSnapAjax.prototype.setOriginalWidth=function(BS){K=BS};FlexSnapAjax.prototype.getOriginalHeight=function(){return AZ};FlexSnapAjax.prototype.setOriginalHeight=function(BS){AZ=BS};FlexSnapAjax.prototype.getDocumentModel=function(){state=Av.getStateForDocumentId(Av.getDocumentId());return state.getDocumentModel()};FlexSnapAjax.prototype.setDocumentModel=function(BS){state=Av.getStateForDocumentId(Av.getDocumentId());state.setDocumentModel(BS)};FlexSnapAjax.prototype.getZoomPercent=function(){return $("#innerDiv").height()/myFlexSnap.getOriginalHeight()};FlexSnapAjax.prototype.getCurrentAnnObject=function(){return Av.currentAnnObject};FlexSnapAjax.prototype.setCurrentAnnObject=function(BS){Av.currentAnnObject=BS;if(BS){Av.backupAnnObject=BS.clone()}else{}};var A6=function(BU){if(vvConfig.retainViewOptionsBetweenPages===false){Av.zoomPercent=100;Av.zoomMode=vvConfig.defaultZoomMode;rotateAngle=0;AP=false;AE=false;Aa=false;Am=0;Ai=0;zoomOffsetTopVal=0;zoomOffsetLeftVal=0;zoomToOffset=false}else{var BV=Av.getStateForDocumentId(Av.getDocumentId());if(BV){if((BU!==undefined)&&(BU!==null)){BB(BU)}if(vvConfig.defaultZoomMode!==vvDefines.zoomModes.fitLast){Av.zoomPercent=BV.getZoomForPage(Aj);Av.zoomMode=BV.getZoomModeForPage(Aj)}rotateAngle=BV.getRotationForPage(Aj);AP=BV.getHorizontalFlipForPage(Aj);AP=BV.getVerticalFlipForPage(Aj);Aa=BV.getInvertImageForPage(Aj);var BS=BV.getScrollTopForPage(Aj);var BT=BV.getScrollLeftForPage(Aj);K=BV.getOriginalWidthForPage(Aj);AZ=BV.getOriginalHeightForPage(Aj);F=BV.getDisplayName();if(BS){zoomOffsetTopVal=BS;zoomToOffset=true}else{zoomToOffset=false}if(BT){zoomOffsetLeftVal=BT;zoomToOffset=true}else{zoomToOffset=false}A0()}}};var BB=function(BT){var BX=Av.getStateForDocumentId(Av.getDocumentId());if(BX){if(vvConfig.defaultZoomMode!==vvDefines.zoomModes.fitLast){BX.setZoomModeForPage(BT,Av.zoomMode);BX.setZoomForPage(BT,Av.zoomPercent)}else{BX.setZoomModeForPage(BT,vvDefines.zoomModes.fitLast)}BX.setRotationForPage(BT,rotateAngle);BX.setHorizontalFlipForPage(BT,AP);BX.setVerticalFlipForPage(BT,AE);BX.setInvertImageForPage(BT,Aa);if(vvDefines.autoSaveAnnotations===true){Av.saveAnnotations()}BX.setOriginalWidthForPage(BT,K);BX.setOriginalHeightForPage(BT,AZ);BX.setDisplayName(F);if(vvConfig.imageScrollBars===true){var BW=document.getElementById("outerDiv");BX=Av.openDocuments[Av.getDocumentId()];if(zoomToOffset===true){BX.setScrollLeftForPage(BT,zoomOffsetLeftVal);BX.setScrollTopForPage(BT,zoomOffsetTopVal)}else{BX.setScrollLeftForPage(BT,BW.scrollLeft);BX.setScrollTopForPage(BT,BW.scrollTop)}}else{var BV=document.getElementById("innerDiv");var BS=stripPx(BV.style.top);var BU=stripPx(BV.style.left);if(zoomToOffset===true){BX.setScrollLeftForPage(BT,zoomOffsetLeftVal);BX.setScrollTopForPage(BT,zoomOffsetTopVal)}else{BX.setScrollLeftForPage(BT,BU*-1);BX.setScrollTopForPage(BT,BS*-1)}}}};var AN=function(Be,BT){var Bb=document.getElementById("outerDiv").clientWidth;var BY=document.getElementById("outerDiv").clientHeight;var BU=document.getElementById("innerDiv");BU.style.height=Be+"px";BU.style.width=BT+"px";var Bd=stripPx(BU.style.left);var Bc=stripPx(BU.style.top);var BZ=Math.abs(Math.floor(Bd/vvDefines.tilePixelSize))-1;var BX=Math.abs(Math.floor(Bc/vvDefines.tilePixelSize))-1;var BW=Math.ceil(Bb/vvDefines.tilePixelSize)+1;var BV=Math.ceil(BY/vvDefines.tilePixelSize)+1;if(BZ<0){BZ=0}if(BX<0){BX=0}var Ba=[];var BS=0;for(x=BZ;x<(BW+BZ);x++){for(y=BX;y<(BV+BX);y++){Ba[BS++]=[x,y]}}return Ba};FlexSnapAjax.prototype.initToolbar=function(){$("#imageControlsDiv > div").mousedown(function(){$(this).toggleClass("mouseDown")});$("#imageControlsDiv > div").mouseup(function(){$(this).toggleClass("mouseDown")});$("#annToolbar > div").mousedown(function(){$(this).toggleClass("mouseDown")});$("#annToolbar > div").mouseup(function(){$(this).toggleClass("mouseDown")});$("#imageControlsDiv > div").each(function(){$(this).toggleClass("mouseDown")});$("#annToolbar > div").each(function(){$(this).toggleClass("mouseDown")})};FlexSnapAjax.prototype.zoomRubberband=function(){Az="Rectangle";pointArray=[];Y=0;J(vvDefines.dragModes.zoom)};FlexSnapAjax.prototype.updateMobileLayout=function(){switch(window.orientation){case 0:case 180:document.body.setAttribute("class","portrait");break;case 90:case -90:document.body.setAttribute("class","landscape");state=Av.getStateForDocumentId(Av.getDocumentId());Av.loadVisibleThumbs(null,state,false);Av.loadVisibleThumbs(null,state,true);break}g();setTimeout(function(){window.scrollTo(0,1)},100)};FlexSnapAjax.prototype.getActiveTab=function(){return this.activeTab};FlexSnapAjax.prototype.setActiveTab=function(BS){this.activeTab=BS};var AI=function(BT,BS){var BU=null;if(BT){$("#vvDocThumbsInternal").remove();BU=document.createElement("table");BU.id="vvDocThumbsInternal";$("#vvDocThumbs").append(BU)}else{if(BS){$("#vvSearchInternal").remove();BU=document.createElement("table");BU.id="vvSearchInternal";$("#vvSearchResults").append(BU)}else{$("#vvPageThumbsInternal").remove();BU=document.createElement("table");BU.id="vvPageThumbsInternal";$("#vvPageThumbs").append(BU)}}};var AS={};FlexSnapAjax.prototype.copySelection=function(){var BS=myFlexSnap.getDocumentModel();var BU=myFlexSnap.getStateForDocumentId(Av.getDocumentId());var BT=BS.getSelectedPageNumbers();if(BT.length===0){return false}AS.state=BU.copyPages(BT,0);AS.layerNames=BU.getLayerNames();AS.model=BS.copySelection();return true};FlexSnapAjax.prototype.cutSelection=function(Ba){var BU=myFlexSnap.getDocumentModel();var BS=myFlexSnap.getStateForDocumentId(Av.getDocumentId());var BV=BU.getSelectedPageNumbers();if(BV.length===0){return false}var BZ=0;for(var BW=0;BW<BU.selection.length;BW+=1){if(BU.selection[BW]===true){$("#vvPageThumbsInternal")[0].deleteRow(BW-BZ);BZ++}}if(Ba!==true){AS.model=BU.cutSelection();AS.layerNames=BS.getLayerNames();AS.state=BS.cutPages(BV,0)}else{BU.cutSelection();BS.cutPages(BV,0)}j=BU.getDocumentLength();var BX=0;$("#vvPageThumbsInternal").find("td").each(function(){$(this).data("pageNumber",BX);$(this).find(".thumbBox")[0].title="Page "+(BX+1);$(this).find(".thumbBox").tooltip();BX+=1});K=0;AZ=0;if(j===0){var BT=document.getElementById("vvImageCanvas");var BY=BT.getContext("2d");BY.clearRect(0,0,BT.width,BT.height);myPainter.clearAnnotations()}else{if(BV[0]===j){myFlexSnap.setPage(j-1)}else{myFlexSnap.setPage(BV[0])}}if(j>0){myFlexSnap.requestAnnotations(BS);myFlexSnap.loadVisibleThumbs(null,BS,false)}return true};FlexSnapAjax.prototype.pasteSelection=function(BV,BT){var BS=myFlexSnap.getDocumentModel();var BU=myFlexSnap.getStateForDocumentId(Av.getDocumentId());BS.paste(AS.model,BV);BU.pastePages(AS.state,BV);BU.setLayerNames(AS.layerNames);j=BS.getDocumentLength();BU.setPageCount(j);myFlexSnap.requestAnnotations(BU);AI(false,false);A8(BU,false,false);if(!BT){myFlexSnap.loadVisibleThumbs(null,BU,false);myFlexSnap.setPage(BV)}};FlexSnapAjax.prototype.showAboutDialog=function(){$("#vvAboutDialog").dialog("open")};FlexSnapAjax.prototype.toggleThumbnailPanel=function(BS){if(BS===undefined){if($("#vvImagePanel").hasClass("noThumbs")){BS=true}else{BS=false}}if(BS===true){$("#vvImagePanel").removeClass("noThumbs");$("#vvThumbs").show();vvConfig.showThumbnailPanel=true;var BT=myFlexSnap.getStateForDocumentId(Av.getDocumentId());A8(BT,false);A8(BT,true);myFlexSnap.loadVisibleThumbs(null,BT,false);myFlexSnap.loadVisibleThumbs(null,BT,true)}else{$("#vvImagePanel").addClass("noThumbs");$("#vvThumbs").hide();vvConfig.showThumbnailPanel=false;AI(false);AI(true)}myFlexSnap.processWindowResize()};FlexSnapAjax.prototype.setDocumentIdGenerator=function(BS){e=BS};FlexSnapAjax.prototype.setSaveDocumentCompletedHandler=function(BS){BL=BS};FlexSnapAjax.prototype.clearSearchResults=function(BU){Av.searchCancel=false;Av.currentMatch=0;var BT=document.getElementById("vvSearchCanvas");var BS=BT.getContext("2d");BS.clearRect(0,0,BT.width,BT.height);AI(false,true);if(!BU){BU=myFlexSnap.getStateForDocumentId(Av.getDocumentId())}if(BU){BU.clearSearchResults()}};FlexSnapAjax.prototype.searchText=function(BT,BW,BV){var BU=myFlexSnap.getStateForDocumentId(Av.getDocumentId());if(!BT||(BT==="")){return }Av.clearSearchResults(BU);$("#vvSearchTerm").hide();$("#vvSearchProgressText").text(BT);$("#vvSearchProgress").progressbar("value",0);$("#vvSearchProgress").show();$("#vvSearchProgressCancel").css("visibility","visible");var BS=$("#vvSearchProgress").width();$("#vvSearchProgressText").width(BS-2);$("#vvSearchProgressCancel").position({my:"right",at:"right",of:"#vvSearchProgressText"});if((!BW)||(BW<0)){BW=0}if((!BV)||(BV>BU.getPageCount())){BV=BU.getPageCount()}BO(BT,BW,BW+vvDefines.searchBatchSize,vvConfig.searchCaseSensitive,false)};var BO=function(BU,BY,BX,BS,BV){var BW=Av.getStateForDocumentId(Av.getDocumentId());var BT=vvConfig.servletPath+"?action=searchDocument&documentId="+BW.getDocumentId()+"&clientInstanceId="+Av.getClientInstanceId();if(vvDefines.cacheBuster===true){BT+="&cacheBuster="+Math.random()}BT+="&searchText="+escape(BU);if(BX>BW.getPageCount()-1){BX=BW.getPageCount()-1}BT+="&firstPage="+BY;BT+="&lastPage="+BX;if(BS){BT+="&caseSensitive=true"}if(BV){BT+="&exactMatch=true"}if(Ay){clearTimeout(Ay)}$.ajax({url:BT,dataType:"json",success:function(BZ){h(BZ,BU,BY,BX,BS,BV)},error:function(BZ){console.log("error")}})};var h=function(BW,BT,BV,BY,Ba,BX){if(Av.searchCancel){return }state.addSearchResults(BW);b();var BS=BW[0].pageNumber;var BU=BW[BW.length-1].pageNumber;var BZ=state.getPageNumber();$("#vvSearchProgress").progressbar("value",(BU/state.getPageCount())*100);A8(state,false,true,BS,BU+1);Av.loadVisibleThumbs(null,state,false,true);if((BZ>=BS)&&(BZ<=BU)){Av.paintSearchResults()}if(!Av.searchCancel&&(BY<(state.getPageCount()-1))){Ay=setTimeout(function(Bb){BO(BT,BY,BY+vvDefines.searchBatchSize,Ba,BX)},vvDefines.searchTimeout)}else{$("#vvSearchProgress").hide();$("#vvSearchProgressText").text("");$("#vvSearchProgress").progressbar("value",0);$("#vvSearchTerm").show()}};FlexSnapAjax.prototype.cancelCurrentSearch=function(BS){Av.searchCancel=true;clearTimeout(Ay);$("#vvSearchProgress").hide();$("#vvSearchProgressText").text("");$("#vvSearchProgress").progressbar("value",0);$("#vvSearchTerm").show()};FlexSnapAjax.prototype.isDocumentSearchable=function(){var BS=Av.getStateForDocumentId(Av.getDocumentId());return BS.getIsSearchable()};FlexSnapAjax.prototype.nextSearchResult=function(){var BY=Av.getStateForDocumentId(Av.getDocumentId());var BU=BY.getPageNumber();var BW=BY.getPageCount();var BX=BY.getSearchResultsForPage(BU);Av.currentMatch++;if((!BX)||(Av.currentMatch>=BX.matches.length)){Av.currentMatch=0;var BT=BY.getPageNumber()+1;if(BT<BW){for(var BS=BT;BS<BW;BS+=1){var BV=BY.getSearchResultsForPage(BS);if(BV){Av.setPage(BS);break}}}}else{Av.paintSearchResults()}b()};FlexSnapAjax.prototype.previousSearchResult=function(){var BV=Av.getStateForDocumentId(Av.getDocumentId());Av.currentMatch--;if(Av.currentMatch<0){Av.currentMatch=0;var BT=BV.getPageNumber()-1;if(BT>=0){for(var BS=BT;BS>=0;BS-=1){var BU=BV.getSearchResultsForPage(BS);if(BU){Av.currentMatch=BU.matches.length-1;Av.setPage(BS);break}}}}else{Av.paintSearchResults()}b()};FlexSnapAjax.prototype.paintSearchResults=function(){var BT=document.getElementById("vvSearchCanvas");var Bf=BT.getContext("2d");Bf.clearRect(0,0,BT.width,BT.height);Bf.lineWidth=2;var Bc=state.getSearchResultsForPage(myFlexSnap.getPageNumber());var Bd=Av.zoomPercent/100;var Be=state.getRotationForPage(state.getPageNumber());if(Bc){for(var BZ=0;BZ<Bc.matches.length;BZ+=1){var BW=Bc.matches[BZ];if(BZ===Av.currentMatch){Bf.strokeStyle=vvDefines.searchSelectedColor;Bf.fillStyle=vvDefines.searchSelectedColor}else{Bf.strokeStyle=vvDefines.searchDefaultColor;Bf.fillStyle=vvDefines.searchDefaultColor}for(var Ba=0;Ba<BW.rectangles.length;Ba+=1){var BY=BW.rectangles[Ba];var BX=BY.top*Bd;var BS=BY.bottom*Bd;var BU=BY.left*Bd;var Bb=BY.right*Bd;var BV=new BoundingBox(BU,BX,Bb-BU,BS-BX);if(Be===90||Be===270){BV.rotate(Be,BT.height,BT.width)}else{BV.rotate(Be,BT.width,BT.height)}Bf.beginPath();Bf.moveTo(BV.getX1(),BV.getY1());Bf.lineTo(BV.getX2(),BV.getY1());Bf.lineTo(BV.getX2(),BV.getY2());Bf.lineTo(BV.getX1(),BV.getY2());Bf.closePath();Bf.fill();Bf.stroke()}}}};function AM(BS){if(BS.nodeType===1){BS.setAttribute("unselectable","on")}var BT=BS.firstChild;while(BT){AM(BT);BT=BT.nextSibling}}};