function Annotation(D,J,C,E,M,F,K,L,H,G){if(!D){return }this.pageWidth=J;this.pageHeight=C;this.preview=false;this.annDelete=false;this.doubleByte=M;this.index=F;this.docDPI=K;this.isFilenet=L;this.isDaeja=H;this.isIDM=G;this.createDate=getValue(D,"annCreateDate");this.layerName=E;var A=document.getElementById("vvAnnotationCanvas");this.type=getValue(D,"annType");this.ordinal=parseInt(getValue(D,"annOrdinal"),10);var B=getValue(D,"annLayerID");if(B!=="ANNOTATION_LAYER_ID"){this.layerName=B}this.box=new BoundingBox(parseInt(getValue(D,"annStartX"),10),parseInt(getValue(D,"annStartY"),10),parseInt(getValue(D,"annWidth"),10),parseInt(getValue(D,"annHeight"),10));this.lineColor=getValue(D,"lineColor");this.fillColor=getValue(D,"fillColor");this.opacity=1;fillTransparent=getValue(D,"fillTransparent");if(fillTransparent){if(fillTransparent==="true"){this.opacity=0.5}}else{this.opacity=1}this.lineWidth=getValue(D,"lineWidth");if(this.lineWidth){this.lineWidth=parseInt(this.lineWidth,10)}else{this.lineWidth=1}this.lineStyle=getValue(D,"lineStyle");this.rotationAngle=getValue(D,"rotationAngle");if(this.rotationAngle){this.rotationAngle=parseInt(this.rotationAngle,10)}else{this.rotationAngle=0}var I=getValue(D,"pointArray");if(I){this.pointArray=parsePointArray(I);this.fixBoundingBox()}this.fontName=getValue(D,"fontName");this.fontSize=getValue(D,"fontSize");this.fontBold=fixBooleanString(getValue(D,"fontBold"));this.fontItalic=fixBooleanString(getValue(D,"fontItalic"));this.fontStrike=fixBooleanString(getValue(D,"fontStrike"));this.fontUnderline=fixBooleanString(getValue(D,"fontUnderline"));this.fontColor=getValue(D,"fontColor");if(this.fontSize){this.setFontSize(parseInt(this.fontSize,10),true)}this.setTextString(getValue(D,"textString"),true)}Annotation.prototype.copyFrom=function(F){var D=this;var C=F;D.pageWidth=C.getPageWidth();D.pageHeight=C.getPageHeight();D.preview=C.getPreview();D.annDelete=C.getDelete();D.doubleByte=C.getDoubleByte();D.index=C.getIndex();D.layerName=C.getLayerName();D.type=C.getType();D.ordinal=C.getOrdinal();D.layerName=C.getLayerName();var B=C.getBoundingBox();D.box=new BoundingBox(B.getX1(),B.getY1(),B.getWidth(),B.getHeight());D.lineColor=C.getLineColorRGB();D.fillColor=C.getFillColorRGB();D.opacity=C.getOpacity();D.lineWidth=C.getLineWidth();D.lineStyle=C.getLineStyle();D.rotationAngle=C.getRotationAngle();var E=C.getPointArray();C.pointArray=[];if(E){for(var A=0;A<E.length;A+=1){C.pointArray.push(new Point(E[A].getX(),E[A].getY()))}}else{C.pointArray=null}D.fontName=C.getFontName();D.setFontSize(C.getFontSize(true),true);D.fontBold=C.getFontBold();D.fontItalic=C.getFontItalic();D.fontStrike=C.getFontStrike();D.fontUnderline=C.getFontUnderline();D.fontColor=C.getFontColor();D.setTextString(C.getTextString());return D};Annotation.prototype.clone=function(){var A=new Annotation();A.copyFrom(this);return A};Annotation.prototype.getType=function(){return this.type};Annotation.prototype.getDelete=function(){return this.annDelete};Annotation.prototype.setDelete=function(A){this.annDelete=A};Annotation.prototype.getDoubleByte=function(){return this.doubleByte};Annotation.prototype.setDoubleByte=function(A){this.doubleByte=A};Annotation.prototype.fixCoordinates=function(){this.box=new BoundingBox(Math.round(this.box.getX1()/this.getWidthRatio()),Math.round(this.box.getY1()/this.getHeightRatio()),Math.round(this.box.getWidth()/this.getWidthRatio()),Math.round(this.box.getHeight()/this.getHeightRatio()));if(this.pointArray){for(var A=0;A<this.pointArray.length;A+=1){this.pointArray[A].setX(Math.round(this.pointArray[A].getX()/this.getWidthRatio()));this.pointArray[A].setY(Math.round(this.pointArray[A].getY()/this.getHeightRatio()))}}};Annotation.prototype.fixBoundingBox=function(){var I=null;var H=null;var C=null;var J=null;if(this.pointArray&&(this.pointArray.length>1)){var E=this.pointArray[0].getX();var D=this.pointArray[0].getY();var B=this.pointArray[0].getX();var A=this.pointArray[0].getY();if(this.pointArray){for(var F=0;F<this.pointArray.length;F+=1){if(this.pointArray[F].getX()<E){E=this.pointArray[F].getX()}if(this.pointArray[F].getY()<D){D=this.pointArray[F].getY()}if(this.pointArray[F].getX()>B){B=this.pointArray[F].getX()}if(this.pointArray[F].getY()>A){A=this.pointArray[F].getY()}}}I=E;H=D;C=B-E;J=A-D;if(this.type===vvDefines.annotationTypes.SANN_CIRCLE){if(rotateAngle===0){J=C}else{if(rotateAngle===90){C=J}else{if(rotateAngle===180){J=C*-1;H=A}else{if(rotateAngle===270){C=J*-1;I=B}}}}}this.box=new BoundingBox(I,H,C,J)}var G=this.getBoundingBox();I=G.getX1();H=G.getY1();C=G.getWidth();J=G.getHeight();if(C<0){C=C*-1;I=I-C}if(J<0){J=J*-1;H=H-J}this.box=new BoundingBox(I,H,C,J)};Annotation.prototype.rotate=function(C){this.box.rotate(C,this.pageWidth,this.pageHeight);this.rotatePointArray(C);this.fixBoundingBox();if((Math.abs(C)===90)||(Math.abs(C)===270)){var A=this.pageWidth;var B=this.pageHeight;this.pageWidth=B;this.pageHeight=A}};Annotation.prototype.rotatePointArray=function(B){if(!this.pointArray){return null}for(var A=0;A<this.pointArray.length;A+=1){this.pointArray[A].rotate(B,this.pageWidth,this.pageHeight)}};Annotation.prototype.getIndex=function(){return this.index};Annotation.prototype.setIndex=function(A){this.index=A};Annotation.prototype.getOrdinal=function(){return this.ordinal};Annotation.prototype.setCreateDate=function(A){this.createDate=A};Annotation.prototype.getCreateDate=function(){return this.createDate};Annotation.prototype.setOrdinal=function(A){this.ordinal=A};Annotation.prototype.getWidthRatio=function(){var A=document.getElementById("vvAnnotationCanvas");var B=A.width/this.pageWidth;return B};Annotation.prototype.getHeightRatio=function(){var A=document.getElementById("vvAnnotationCanvas");var B=A.height/this.pageHeight;return B};Annotation.prototype.getPageWidth=function(){return this.pageWidth};Annotation.prototype.setPageWidth=function(A){this.pageWidth=A};Annotation.prototype.getPageHeight=function(){return this.pageHeight};Annotation.prototype.setPageHeight=function(A){this.pageHeight=A};Annotation.prototype.getLayerName=function(){if(!this.layerName){return"ANNOTATION_LAYER_ID"}else{return this.layerName}};Annotation.prototype.setLayerName=function(A){this.layerName=A};Annotation.prototype.getBoundingBox=function(){return this.box};Annotation.prototype.setBoundingBox=function(A){this.box=A};Annotation.prototype.getLineColor=function(){if(this.lineColor&&(this.lineColor!=="NO_COLOR")){return parseColorString(this.lineColor)}else{return null}};Annotation.prototype.setLineColor=function(A){this.lineColor=A};Annotation.prototype.getFillColor=function(){if(this.fillColor){return parseColorString(this.fillColor,this.opacity)}else{return null}};Annotation.prototype.setFillColor=function(A){this.fillColor=A};Annotation.prototype.getLineColorRGB=function(){if(this.lineColor){return this.lineColor}else{return null}};Annotation.prototype.setLineColorRGB=function(A){this.lineColor=A};Annotation.prototype.getFillColorRGB=function(){if(this.fillColor){return this.fillColor}else{return null}};Annotation.prototype.setFillColorRGB=function(A){this.fillColor=A};Annotation.prototype.getRotationAngle=function(){if(this.rotationAngle){return this.rotationAngle}else{return 0}};Annotation.prototype.setRotationAngle=function(A){this.rotationAngle=A};Annotation.prototype.getLineWidth=function(C){var A=300;var B=1/this.getHeightRatio();if(C){return this.lineWidth}else{var D=parseInt(this.lineWidth/B,10);if(D<1){D=1}return D}};Annotation.prototype.setLineWidth=function(D,C){var A=300;var B=1/this.getHeightRatio();if(C){this.lineWidth=D}else{this.lineWidth=D*B}};Annotation.prototype.getLineStyle=function(){return this.lineStyle};Annotation.prototype.setLineStyle=function(A){this.lineStyle=A};Annotation.prototype.getOpacity=function(){return this.opacity};Annotation.prototype.getPointArray=function(){return this.pointArray};Annotation.prototype.setPointArray=function(A){this.pointArray=A};Annotation.prototype.getFontName=function(){return this.fontName};Annotation.prototype.setFontName=function(A){this.fontName=A};Annotation.prototype.getFontSize=function(A){var B=300;var C=1/this.getHeightRatio();if(A){return this.fontSize}else{if(this.isIDM){return Math.round(this.fontSize*7.2/120)}else{return Math.round(this.fontSize*72/96)}}};Annotation.prototype.setFontSize=function(C,D){var A=300;var B=1/this.getHeightRatio();if(D){this.fontSize=C}else{if(this.isIDM){this.fontSize=C*120/7.2}else{this.fontSize=C*96/72}}};Annotation.prototype.getFontBold=function(){return this.fontBold};Annotation.prototype.setFontBold=function(A){this.fontBold=A};Annotation.prototype.getFontItalic=function(){return this.fontItalic};Annotation.prototype.setFontItalic=function(A){this.fontItalic=A};Annotation.prototype.getFontStrike=function(){return this.fontStrike};Annotation.prototype.setFontStrike=function(A){this.fontStrike=A};Annotation.prototype.getFontUnderline=function(){return this.fontUnderline};Annotation.prototype.setFontUnderline=function(A){this.fontUnderline=A};Annotation.prototype.getPreview=function(){return this.preview};Annotation.prototype.setPreview=function(A){this.preview=A};Annotation.prototype.getFontColor=function(){return this.fontColor};Annotation.prototype.setFontColor=function(A){this.fontColor=A};Annotation.prototype.getTextString=function(A){if(A||!this.doubleByte){return this.textString}else{return Base64.decode(this.textString)}};Annotation.prototype.setTextString=function(B,A){if(A||!this.doubleByte){this.textString=B}else{this.textString=Base64.encode(B);this.doubleByte=true}};Annotation.prototype.move=function(C){var D=this.box;this.box=new BoundingBox(Math.round(C.getX()/this.getWidthRatio()),Math.round(C.getY()/this.getHeightRatio()),D.getWidth(),D.getHeight());var B=this.box.getX1()-D.getX1();var A=this.box.getY1()-D.getY1();this.movePointArray(B,A)};Annotation.prototype.stretchLine=function(B,E,D){var C=(vvConfig.polygonNubSize/2)/this.getWidthRatio();var A=Math.round(E/this.getWidthRatio());var F=Math.round(D/this.getHeightRatio());if(B===vvDefines.lineEnds.start){this.pointArray[0]=new Point(A,F)}else{if(B===vvDefines.lineEnds.end){this.pointArray[1]=new Point(A,F)}}};Annotation.prototype.stretch=function(J,E,C){if(E>$("#innerDiv").width()){E=$("#innerDiv").width()}else{if(E<0){E=0}}if(C>$("#innerDiv").height()){C=$("#innerDiv").height()}else{if(C<0){C=0}}var I=E/this.getWidthRatio();var H=C/this.getHeightRatio();var D=this.box;var B;var K;var G;var A;var F=60;if(this.getType()===vvDefines.annotationTypes.SANN_POSTIT){if(J===vvDefines.corners.upperLeft){B=I;K=H;G=D.getX2()-B;if(G<F){G=F}A=D.getY2()-K;if(A<F){A=F}}else{if(J===vvDefines.corners.upperRight){B=D.getX1();K=H;G=I-B;if(G<F){G=F}A=D.getY2()-K;if(A<F){A=F}}else{if(J===vvDefines.corners.lowerLeft){B=I;K=D.getY1();G=D.getX2()-B;if(G<F){G=F}A=H-K;if(A<F){A=F}}else{if(J===vvDefines.corners.lowerRight){B=D.getX1();K=D.getY1();G=I-B;if(G<F){G=F}A=H-K;if(A<F){A=F}}}}}}else{if(J===vvDefines.corners.upperLeft){B=I;K=H;G=D.getX2()-B;A=D.getY2()-K}else{if(J===vvDefines.corners.upperRight){B=D.getX1();K=H;G=I-B;A=D.getY2()-K}else{if(J===vvDefines.corners.lowerLeft){B=I;K=D.getY1();G=D.getX2()-B;A=H-K}else{if(J===vvDefines.corners.lowerRight){B=D.getX1();K=D.getY1();G=I-B;A=H-K}}}}}if((G>0)&&(A>0)){this.box=new BoundingBox(B,K,G,A);this.stretchPointArray(D,this.box)}};Annotation.prototype.movePointArray=function(C,B){if(this.pointArray){for(var A=0;A<this.pointArray.length;A+=1){this.pointArray[A].setX(Math.round(this.pointArray[A].getX()+C));this.pointArray[A].setY(Math.round(this.pointArray[A].getY()+B))}}};Annotation.prototype.stretchPointArray=function(G,B){var C=B.getX1();var F=B.getY1();var E=B.getWidth()/G.getWidth();var D=B.getHeight()/G.getHeight();if(this.pointArray){for(var A=0;A<this.pointArray.length;A+=1){this.pointArray[A].setX(Math.round(C+((this.pointArray[A].getX()-G.getX1())*E)));this.pointArray[A].setY(Math.round(F+((this.pointArray[A].getY()-G.getY1())*D)))}}};Annotation.prototype.toXML=function(){var E=this.getType();if(E===vvDefines.annotationTypes.SANN_CIRCLE){E=vvDefines.annotationTypes.SANN_ELLIPSE}if(this.annDelete===true){return""}returnString="<annObject><annMeta><annID>ANN_ID</annID><annType>";returnString+=E+"</annType><annLayerID>";returnString+=this.getLayerName()+"</annLayerID><annOrdinal>";returnString+=this.getOrdinal()+"</annOrdinal><annDelete>false</annDelete><annHistory><annCreateDate>";returnString+=this.getCreateDate()+"</annCreateDate><annCreateUser/></annHistory></annMeta><annTransparent>false</annTransparent>";if((E===vvDefines.annotationTypes.SANN_EDIT)||(E===vvDefines.annotationTypes.SANN_BUBBLE)||(E===vvDefines.annotationTypes.SANN_POSTIT)||(E===vvDefines.annotationTypes.SANN_CLOUD_EDIT)){returnString+="<fontInfo><fontName>";returnString+=this.getFontName()+"</fontName><fontSize>";returnString+=Math.round(this.getFontSize(true))+"px</fontSize><fontBold>";returnString+=this.getFontBold()+"</fontBold><fontItalic>";returnString+=this.getFontItalic()+"</fontItalic><fontStrike>";returnString+=this.getFontStrike()+"</fontStrike><fontUnderline>";returnString+=this.getFontUnderline()+"</fontUnderline><fontColor>";returnString+=this.getFontColor()+"</fontColor></fontInfo><textString>";returnString+=this.getTextString(true)+"</textString>"}if(!this.getFillColor()&&this.getLineColor()||(E===vvDefines.annotationTypes.SANN_POLYGON)){returnString+="<lineInfo><lineStyle>Solid</lineStyle><lineWidth>";returnString+=parseInt(this.getLineWidth(true),10)+"</lineWidth>";if((E===vvDefines.annotationTypes.SANN_POLYGON)&&this.getFillColor()){returnString+="<lineColor>NO_COLOR</lineColor>"}else{returnString+="<lineColor>"+this.getLineColorRGB()+"</lineColor>"}returnString+="<lineTransparent>false</lineTransparent>";if(this.getPointArray()){returnString+="<pointArray>";returnString+=generatePointArrayString(this.getPointArray());returnString+="</pointArray>"}else{returnString+="<pointArray/>"}returnString+="</lineInfo>"}if(this.getFillColor()){returnString+="<fillInfo><fillColor>";returnString+=this.getFillColorRGB()+"</fillColor>";if(this.getOpacity()<1){returnString+="<fillTransparent>true</fillTransparent>";returnString+="<fillTransparentPercent />"}else{returnString+="<fillTransparent>false</fillTransparent>";returnString+="<fillTransparentPercent />"}returnString+="</fillInfo>"}returnString+="<rotationAngle>"+this.getRotationAngle()+"</rotationAngle>";var C=Math.round(this.getBoundingBox().getX1());var B=Math.round(this.getBoundingBox().getY1());var A=Math.round(this.getBoundingBox().getHeight());var D=Math.round(this.getBoundingBox().getWidth());if((E===vvDefines.annotationTypes.SANN_LINE)||(E===vvDefines.annotationTypes.SANN_ARROW)){var G=this.pointArray[0];var F=this.pointArray[1];if(G.getX()>F.getX()){D*=-1;C=G.getX()}if(G.getY()>F.getY()){A*=-1;B=G.getY()}}returnString+="<annStartX>"+C+"</annStartX><annStartY>";returnString+=B+"</annStartY><annHeight>";returnString+=A+"</annHeight><annWidth>";returnString+=D+"</annWidth></annObject>";return returnString};Annotation.prototype.findLineEndpoint=function(A,E,D){var J=(vvConfig.polygonNubSize/2)/E;var G=A.getX()/E;var F=A.getY()/D;var C=this.pointArray[0].getX();var B=this.pointArray[0].getY();var I=this.pointArray[1].getX();var H=this.pointArray[1].getY();if((G>=(C-J))&&(G<=(C+J))&&(F>=(B-J))&&(F<=(B+J))){return vvDefines.lineEnds.start}else{if((G>=(I-J))&&(G<=(I+J))&&(F>=(H-J))&&(F<=(H+J))){return vvDefines.lineEnds.end}else{return null}}};function PreviewAnnotation(I,F,K,A,G,H,L,N,C,J){var B=document.getElementById("vvAnnotationCanvas");this.pageWidth=B.width;this.pageHeight=B.height;this.type=I;this.box=F;this.lineColor=K;this.preview=true;this.annDelete=false;this.index=-1;this.isIDM=J;this.docDPI=C;var D=new Date();this.createDate=toSnowDateString(D);if((N!==undefined)&&(N!==null)){this.doubleByte=N}else{this.doubleByte=vvConfig.base64EncodeAnnotations}var E=I.indexOf("Filled");if(E!==-1){this.fillColor=A;this.type=I.slice(6,I.length)}var M=I.indexOf("Highlight");if(M!==-1){this.fillColor=vvConfig.annotationDefaults.highlightFillColor;this.opacity=H;this.type=I.slice(9,I.length)}else{this.opacity=1}if(I===vvDefines.annotationTypes.SANN_CIRCLE){this.fillColor=A;this.box=new BoundingBox(F.getX1(),F.getY1(),F.getWidth(),F.getWidth())}if(I===vvDefines.annotationTypes.SANN_FREEHAND){this.type=vvDefines.annotationTypes.SANN_LINE}if(I===vvDefines.annotationTypes.SANN_FILLED_POLYGON){this.type=vvDefines.annotationTypes.SANN_POLYGON}if((I===vvDefines.annotationTypes.SANN_EDIT)||(I===vvDefines.annotationTypes.SANN_BUBBLE)||(I===vvDefines.annotationTypes.SANN_CLOUD_EDIT)||(I===vvDefines.annotationTypes.SANN_POSTIT)){this.setTextString(vvConfig.annotationDefaults.textString);this.setFontName(vvConfig.annotationDefaults.fontFace);this.setFontSize(vvConfig.annotationDefaults.fontSize);this.setFontBold(vvConfig.annotationDefaults.fontBold);this.setFontItalic(vvConfig.annotationDefaults.fontItalic);this.setFontStrike(vvConfig.annotationDefaults.fontStrike);this.setFontUnderline(vvConfig.annotationDefaults.fontUnderline);this.setFontColor(vvConfig.annotationDefaults.fontColor.toString())}if(G){this.setLineWidth(parseInt(G,10))}else{this.setLineWidth(1)}if(L){this.pointArray=L;this.fixBoundingBox()}}PreviewAnnotation.prototype=Annotation.prototype;